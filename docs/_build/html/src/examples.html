
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Example simulations and analysis using pycoalescence &#8212; pycoalescence 1.2.7a5 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.7a5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script type="text/javascript" src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="shortcut icon" href="../_static/PyCoal_favicon_large.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modules" href="../modules.html" />
    <link rel="prev" title="Merging simulation outputs" href="../README_merger.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../modules.html" title="Modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../README_merger.html" title="Merging simulation outputs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pycoalescence 1.2.7a5 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="Example-simulations-and-analysis-using-pycoalescence">
<h1>Example simulations and analysis using pycoalescence<a class="headerlink" href="#Example-simulations-and-analysis-using-pycoalescence" title="Permalink to this headline">¶</a></h1>
<p>This jupyter notebook shows a variety of full example simulations that
can be run using the files provided in the <em>sample</em> folder in
<strong>pycoalescence</strong>. They are intended to be used as templates for your
own simulations.</p>
<p>Note that this notebook requires Python 3.x and a full install of
<strong>pycoalescence</strong>.</p>
<p>First import the necessary modules</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">CoalescenceTree</span>
</pre></div>
</div>
</div>
<p>Define our input and output directories - <strong>change these as required</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">input_dir</span> <span class="o">=</span> <span class="s2">&quot;pycoalescence/tests/sample&quot;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Basic-spatial-simulation-and-analysis">
<h2>Basic spatial simulation and analysis<a class="headerlink" href="#Basic-spatial-simulation-and-analysis" title="Permalink to this headline">¶</a></h2>
<p>Basic spatial simulation on just one map file, with a closed landscape.
For this example we run with full logging (at ‘debug’ level). All other
examples will be run using ‘critical’ level, which shouldn’t output any
information unless there is a problem.</p>
<p>Use a speciation rate of 0.1, a dispersal of 2.0 (sigma) and 10
individuals per cell (deme).</p>
<p>The output will be stored in <em>output/data_1_1.db</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sim1</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">sim1</span><span class="o">.</span><span class="n">set_simulation_parameters</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">min_speciation_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                                       <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deme</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Use automatic detection of the map file dimensions</span>
<span class="n">sim1</span><span class="o">.</span><span class="n">set_map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_fine.tif&quot;</span><span class="p">))</span>
<span class="n">sim1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
Checking folder existance...pycoalescence/tests/sample/SA_sample_fine.tif exists!
Output folder does not exist... creating...done!
Checking folder existance...done!
Checking for unfinished simulations...done!
No files found containing unfinished simulations.
*************************************************
Setting up simulation...
Dispersal (tau, sigma): 1, 2
Dispersal method: normal
Fine map
-file: pycoalescence/tests/sample/SA_sample_fine.tif
-dimensions: (13, 13)
-offset: (0, 0)
Coarse map
-file: none
-dimensions: (13, 13)
-offset: (0, 0)
-scale: 1
Sample grid
-dimensions: (13, 13)
-optimised area: (13, 13)
-optimised offsets: (0, 0)
-deme: 10
Seed: 1
Speciation rate: 0.1
Job Type: 1
Max time: 3600
-deme sample: 1
Output directory: output
Disp Rel Cost: 1
Times:  0.0
Checking folder existance...pycoalescence/tests/sample/SA_sample_fine.tif exists!
Importing pycoalescence/tests/sample/SA_sample_fine.tif No data value is: 0
Importing pycoalescence/tests/sample/SA_sample_fine.tif ...................done!
No data value is: 0
Using dispersal kernel.
Initial count is 380980
Setting up simulation...done!
Number of individuals simulating: 380980
*************************************************
Beginning simulations...done!
No additional speciation rates to apply.
Speciation rate is: 0.1.
Finalising data...done!
Creating SQL database file...
    Executing SQL commands....done!
0.000000,Calculating generation 0.000000
Calculating tree structure...done!
Number of species: 96371
Generating new SQL table for speciation rate 0.1...done!
    Writing to output/data_1_1.db ....  done!
Total generations simulated (steps): 223.285 (964919)
Setup time was 0 minutes 0 seconds
Simulation time was 0 hours 0 minutes 2 seconds
File output and species calculation time was 0 minutes 5 seconds
SQL output time was 0 minutes 0 seconds
Total simulation and output time was 0 hours 0 minutes 7 seconds
</pre></div></div>
</div>
<p>Re-create the coalescence tree for different speciation rates</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">tree1</span> <span class="o">=</span> <span class="n">CoalescenceTree</span><span class="p">(</span><span class="n">sim1</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree1</span><span class="o">.</span><span class="n">set_speciation_parameters</span><span class="p">(</span><span class="n">speciation_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="n">tree1</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
No sample file provided, defaulting to null.No times provided, defaulting to 0.0.***************************
STARTING CALCULATIONS
Input file is output/data_1_1.db
Speciation rates are: 0.1, 0.2, 0.4.
Protracted speciation parameters (min, max) are:
0, 0
Beginning data import...done
Calculating speciation rate 0.1
Calculating generation 0
calculation already performed for 0.1 at time 0
calculation already performed for 0.1 at time 0
Calculating speciation rate 0.2
Calculating generation 0
Calculating tree structure...done!
Number of species: 152584
Generating new SQL table for speciation rate 0.2...done!
Calculating generation 0
Calculating speciation rate 0.4
Calculating generation 0
Calculating tree structure...done!
Number of species: 232829
Generating new SQL table for speciation rate 0.4...done!
Writing out to output/data_1_1.db...done!
</pre></div></div>
</div>
<p>Print out the species richness for each speciation rate by looping over
our community parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">tree1</span><span class="o">.</span><span class="n">get_community_references</span><span class="p">():</span>
    <span class="n">spec_rate</span> <span class="o">=</span> <span class="n">tree1</span><span class="o">.</span><span class="n">get_community_parameters</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)[</span><span class="s2">&quot;speciation_rate&quot;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Species richness for speciation rate of {} is {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec_rate</span><span class="p">,</span>
                                                                                                                                    <span class="n">tree1</span><span class="o">.</span><span class="n">get_richness</span><span class="p">(</span><span class="n">reference</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Species richness for speciation rate of 0.1 is 96371
Species richness for speciation rate of 0.2 is 152584
Species richness for speciation rate of 0.4 is 232829
</pre></div></div>
</div>
</div>
<div class="section" id="More-complex-spatial-example">
<h2>More complex spatial example<a class="headerlink" href="#More-complex-spatial-example" title="Permalink to this headline">¶</a></h2>
<p>Here we use a sample area, a fine map file (defining high-resolution
density around the area) and a coarse map file (defining the
low-resolution density over a larger area).</p>
<p>Additionally, we provide a historical fine and coarse maps to define the
density at 100 generations in the past (with a rate of 0.5) and 200
generations in the past (with a rate of 0.0).</p>
<p>Within the simulation, we sample the community at times 0, 50 and 100
generations in the past.</p>
<p>The output will be stored in <em>output/data_1_2.db</em></p>
<p>Define our file paths</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sample_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_samplemaskINT.tif&quot;</span><span class="p">)</span>
<span class="n">fine_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_fine.tif&quot;</span><span class="p">)</span>
<span class="n">coarse_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_coarse.tif&quot;</span><span class="p">)</span>
<span class="n">pristine_fine_file1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_fine_pristine1.tif&quot;</span><span class="p">)</span>
<span class="n">pristine_coarse_file1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_coarse_pristine1.tif&quot;</span><span class="p">)</span>
<span class="n">pristine_fine_file2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_fine_pristine2.tif&quot;</span><span class="p">)</span>
<span class="n">pristine_coarse_file2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_coarse_pristine2.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sim2</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">set_simulation_parameters</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">min_speciation_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                                       <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deme</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">set_speciation_rates</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="c1"># Use automatic detection of the map file dimensions</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">set_map_files</span><span class="p">(</span><span class="n">sample_file</span><span class="o">=</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">fine_file</span><span class="o">=</span><span class="n">fine_file</span><span class="p">,</span> <span class="n">coarse_file</span><span class="o">=</span><span class="n">coarse_file</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">add_historical_map</span><span class="p">(</span><span class="n">fine_map</span><span class="o">=</span><span class="n">pristine_fine_file1</span><span class="p">,</span> <span class="n">coarse_map</span><span class="o">=</span><span class="n">pristine_coarse_file1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                            <span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">add_historical_map</span><span class="p">(</span><span class="n">fine_map</span><span class="o">=</span><span class="n">pristine_fine_file2</span><span class="p">,</span> <span class="n">coarse_map</span><span class="o">=</span><span class="n">pristine_coarse_file2</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                            <span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">add_sample_time</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">add_sample_time</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">sim2</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Print the species richness for each time and speciation rate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">tree2</span> <span class="o">=</span> <span class="n">CoalescenceTree</span><span class="p">(</span><span class="n">sim2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">tree2</span><span class="o">.</span><span class="n">get_community_references</span><span class="p">():</span>
    <span class="c1"># Contains a dictionary of the parameters</span>
    <span class="n">community_parameters</span> <span class="o">=</span> <span class="n">tree2</span><span class="o">.</span><span class="n">get_community_parameters</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
    <span class="n">spec_rate</span> <span class="o">=</span> <span class="n">community_parameters</span><span class="p">[</span><span class="s2">&quot;speciation_rate&quot;</span><span class="p">]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">community_parameters</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Species richness at time {} with speciation rate of {} is {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">,</span>
                                                                                                                                                             <span class="n">spec_rate</span><span class="p">,</span>
                                                                                                                                                             <span class="n">tree2</span><span class="o">.</span><span class="n">get_richness</span><span class="p">(</span><span class="n">reference</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Species richness at time 0.0 with speciation rate of 0.1 is 7392.
Species richness at time 50.0 with speciation rate of 0.1 is 7312.
Species richness at time 100.0 with speciation rate of 0.1 is 7456.
Species richness at time 0.0 with speciation rate of 0.2 is 8808.
Species richness at time 50.0 with speciation rate of 0.2 is 8691.
Species richness at time 100.0 with speciation rate of 0.2 is 8764.
Species richness at time 0.0 with speciation rate of 0.3 is 9656.
Species richness at time 50.0 with speciation rate of 0.3 is 9515.
Species richness at time 100.0 with speciation rate of 0.3 is 9647.
</pre></div></div>
</div>
</div>
<div class="section" id="Example-using-protracted-speciation-and-a-metacommunity">
<h2>Example using protracted speciation and a metacommunity<a class="headerlink" href="#Example-using-protracted-speciation-and-a-metacommunity" title="Permalink to this headline">¶</a></h2>
<p>This is the same as the first example, but with protracted speciation
preventing speciation from occuring before 1000 generations, and forcing
speciation to occur at 10000 generations.</p>
<p>The coalescence tree is generated with and without a metacommunity as
well.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sim3</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">sim3</span><span class="o">.</span><span class="n">set_simulation_parameters</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                                                       <span class="n">min_speciation_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deme</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                       <span class="n">protracted</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">min_speciation_gen</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_speciation_gen</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">sim3</span><span class="o">.</span><span class="n">set_speciation_rates</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="c1"># Use automatic detection of the map file dimensions</span>
<span class="n">sim3</span><span class="o">.</span><span class="n">set_map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;SA_sample_fine.tif&quot;</span><span class="p">))</span>
<span class="n">sim3</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Re-create the coalescence tree using sampling from a metacommunity
instead of a speciation rate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">tree3</span> <span class="o">=</span> <span class="n">CoalescenceTree</span><span class="p">(</span><span class="n">sim3</span><span class="p">)</span>
<span class="n">tree3</span><span class="o">.</span><span class="n">set_speciation_parameters</span><span class="p">(</span><span class="n">speciation_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="n">protracted_speciation_min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                            <span class="n">protracted_speciation_max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">metacommunity_speciation_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                                            <span class="n">metacommunity_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">tree3</span><span class="o">.</span><span class="n">add_protracted_parameters</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">tree3</span><span class="o">.</span><span class="n">add_protracted_parameters</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
<span class="n">tree3</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Print out the species richness for each parameter set</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">tree3</span><span class="o">.</span><span class="n">get_community_references</span><span class="p">():</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">tree3</span><span class="o">.</span><span class="n">get_community_parameters</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
    <span class="n">spec_rate</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;speciation_rate&quot;</span><span class="p">]</span>
    <span class="n">proc_min</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;min_speciation_gen&quot;</span><span class="p">]</span>
    <span class="n">proc_max</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_speciation_gen&quot;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Speciation rate of {}, (min gen={}, max gen={})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec_rate</span><span class="p">,</span> <span class="n">proc_min</span><span class="p">,</span> <span class="n">proc_max</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;metacommunity_reference&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">meta_params</span> <span class="o">=</span> <span class="n">tree3</span><span class="o">.</span><span class="n">get_metacommunity_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;metacommunity_reference&quot;</span><span class="p">])</span>
            <span class="n">meta_spec</span> <span class="o">=</span> <span class="n">meta_params</span><span class="p">[</span><span class="s2">&quot;speciation_rate&quot;</span><span class="p">]</span>
            <span class="n">meta_size</span> <span class="o">=</span> <span class="n">meta_params</span><span class="p">[</span><span class="s2">&quot;metacommunity_size&quot;</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Metacommunity used of size {} with speciation rate {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta_size</span><span class="p">,</span> <span class="n">meta_spec</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Species richness: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tree3</span><span class="o">.</span><span class="n">get_richness</span><span class="p">(</span><span class="n">reference</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Speciation rate of 0.1, (min gen=1000.0, max gen=10000.0)
Species richness: 71
Speciation rate of 0.2, (min gen=1000.0, max gen=10000.0)
Species richness: 71
Speciation rate of 0.3, (min gen=1000.0, max gen=10000.0)
Species richness: 71
Speciation rate of 0.1, (min gen=1000.0, max gen=10000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 71
Speciation rate of 0.2, (min gen=1000.0, max gen=10000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 71
Speciation rate of 0.3, (min gen=1000.0, max gen=10000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 71
Speciation rate of 0.1, (min gen=10.0, max gen=5000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 657
Speciation rate of 0.2, (min gen=10.0, max gen=5000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 657
Speciation rate of 0.3, (min gen=10.0, max gen=5000.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 657
Speciation rate of 0.1, (min gen=50.0, max gen=800.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 656
Speciation rate of 0.2, (min gen=50.0, max gen=800.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 657
Speciation rate of 0.3, (min gen=50.0, max gen=800.0)
Metacommunity used of size 100000.0 with speciation rate 0.001.
Species richness: 657
</pre></div></div>
</div>
<div class="section" id="Clean-up">
<h3>Clean up<a class="headerlink" href="#Clean-up" title="Permalink to this headline">¶</a></h3>
<p>Delete the objects from memory to clear from RAM - this is not usually
required as objects will be deleted when they fall out of scope.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sim1</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">sim2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">sim3</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">tree1</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">tree2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">tree3</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/PyCoal_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example simulations and analysis using pycoalescence</a><ul>
<li><a class="reference internal" href="#Basic-spatial-simulation-and-analysis">Basic spatial simulation and analysis</a></li>
<li><a class="reference internal" href="#More-complex-spatial-example">More complex spatial example</a></li>
<li><a class="reference internal" href="#Example-using-protracted-speciation-and-a-metacommunity">Example using protracted speciation and a metacommunity</a><ul>
<li><a class="reference internal" href="#Clean-up">Clean up</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../README_merger.html"
                        title="previous chapter">Merging simulation outputs</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../modules.html"
                        title="next chapter">Modules</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/src/examples.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../modules.html" title="Modules"
             >next</a> |</li>
        <li class="right" >
          <a href="../README_merger.html" title="Merging simulation outputs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pycoalescence 1.2.7a5 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright Copyright 2016, pycoalescence.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>