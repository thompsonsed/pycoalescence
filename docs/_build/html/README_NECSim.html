
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Introduction &#8212; PyCoalescence 1.2.5 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script type="text/javascript" src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="shortcut icon" href="_static/PyCoal_favicon_large.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyCoalescence 1.2.5 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><strong>A Neutral Ecology Coalescence Simulator</strong></p>
<div class="section" id="introduction">
<span id="introduction-necsim"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>Provided here is a set of tools for running and analysing backwards-time (coalescent) neutral models in ecology. NECSim
is a generic spatial coalescence simulator for neutral systems.
It applies the model to maps for the supplied parameters and outputs information for each
individual to a SQL database.</p>
<p>SpeciationCounter is a program for applying varying speciation rates to
outputs of NECSim for analysis after simulations are complete. This
enables the main simulation to be run with the <em>minimum</em> speciation rate
required and afterwards analysis can be completed using different
speciation rates. The same functionality is also provided within NECSim for application of speciation rates immediately
after simulations are complete.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The recommended method of installing the program and running simulations is to use the
<a class="reference internal" href="#introduction-necsim"><span class="std std-ref">PyCoalescence module</span></a>.</p>
</div>
<div class="section" id="a-note-on-the-neutral-theory-of-ecology">
<h2>A Note on the Neutral Theory of Ecology<a class="headerlink" href="#a-note-on-the-neutral-theory-of-ecology" title="Permalink to this headline">¶</a></h2>
<p>Neutral theory in ecology refers to the idea that individuals can be modelled as ecologically identical entities,
undergoing dispersal, drift and speciation without niche effects or other competitive elements.</p>
<p>Whilst obviously not realistic, the patterns produced by such models can often give a surprisingly accurate portrayal of
real-world systems. For more information on the topic, please see <a class="reference internal" href="index.html#hubbell2001" id="id1">[Hubbell2001]</a>.</p>
</div>
</div>
<div class="section" id="instructions">
<h1>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="compiling-the-program">
<h2>Compiling the program<a class="headerlink" href="#compiling-the-program" title="Permalink to this headline">¶</a></h2>
<p>For compilation, there are several provided options:</p>
<ul>
<li><p class="first">Compilation can be handled within PyCoalescence by running <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></code>. <strong>This is the recommended option.</strong></p>
</li>
<li><p class="first">Alternatively, compilation can be completed with additional options using make. The steps are outlined below</p>
<blockquote>
<div><ul class="simple">
<li>You might need to first run <code class="docutils literal"><span class="pre">autoconf</span></code> from within the NECSim directory to generate the configure executable.</li>
<li>Run <code class="docutils literal"><span class="pre">./configure</span></code> (located within the NECSim directory). Provide additional compilation flags if necessary (detailed below).</li>
<li>Run <code class="docutils literal"><span class="pre">make</span> <span class="pre">all</span></code> to create the executable.</li>
<li>[Optional] Move the executable (called NECSim) to the <em>build/Default</em> directory in <strong>PyCoalescence</strong>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If you require compilation outside of the PyCoalescence module, make use of the the file <strong>Makefile</strong> located in
<strong>Makefiles/SimpleCompile</strong>. This can be modified and run using <code class="docutils literal"><span class="pre">make</span></code> to generate the executable.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to also compile the module for integrating with python, provide the python library (PYTHON_LIB) and
python include directories (PYTHON_INCLUDE) as command line flags to <code class="docutils literal"><span class="pre">./configure</span></code>. You must then run This is
not recommended, and it is advised you use the <a class="reference internal" href="README_PyCoalescence.html#introduction-pycoalescence"><span class="std std-ref">install proceedure outlined here</span></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Compilation on High-performance clusters will likely require an icc compiler and custom linking to the
required libraries.</p>
</div>
<p>See the Requirements section for a full list of the necessary
prerequisites.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The SQLite library available <a class="reference external" href="https://www.sqlite.org/download.html">here</a>.</li>
<li>The Boost library available <a class="reference external" href="http://www.boost.org">here</a>.</li>
<li>C++ compiler (such as GNU g++) with C++11 support.</li>
<li>Access to the relevant folders for Default simulations (see FAQS).</li>
</ul>
<p>Recommended, but not essential:</p>
<ul class="simple">
<li>gdal library available <a class="reference external" href="http://www.gdal.org">here</a>: provides reading of tif files.</li>
<li><dl class="first docutils">
<dt>The fast-cpp-csv-parser by Ben Strasser, available</dt>
<dd><a class="reference external" href="https://github.com/ben-strasser/fast-cpp-csv-parser">here</a>: provides much faster csv read and write capabilities.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="compiler-options">
<h3>Compiler Options<a class="headerlink" href="#compiler-options" title="Permalink to this headline">¶</a></h3>
<p>Recognised compiler options include:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>–with-debug</td>
<td>Adds additional debugging information</td>
</tr>
<tr class="row-odd"><td>–with-verbose</td>
<td>Prints information to the terminal. Otherwise, prints to a log file in <em>Logs/</em></td>
</tr>
<tr class="row-even"><td>–with-gdal=DIR</td>
<td>Define a gdal library at DIR</td>
</tr>
<tr class="row-odd"><td>–with-hpc</td>
<td>Compile ready for HPC, using intel’s icpc compilation and a variety of optimisation flags.</td>
</tr>
<tr class="row-even"><td>–with-boost=DIR</td>
<td>Define a boost library at DIR</td>
</tr>
</tbody>
</table>
<p>Additional c++ compilation flags can be specified by <code class="docutils literal"><span class="pre">CPPFLAGS=opts</span></code> for additional library paths or compilation options as required.</p>
<p>Note that gdal and fast-cpp-csv-parser availability will be automatically detected and included in the compilation if possible.</p>
</div>
</div>
<div class="section" id="running-simulations">
<h2>Running simulations<a class="headerlink" href="#running-simulations" title="Permalink to this headline">¶</a></h2>
<p>As of version 3.1 and above, the routine relies on
supplying command line arguments (see below) for all the major
simulation variables. Alternatively, supplying a config .txt file and
using the command line arguments <code class="docutils literal"><span class="pre">./NECSim</span> <span class="pre">-c</span> <span class="pre">/path/to/config.txt</span></code>
can be used for parsing command line arguments from the text file.</p>
<div class="section" id="command-line-arguments">
<h3>Command Line Arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h3>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version This: </span>method of supplying simulation parameters is not recommended and is provided for backwards-compatibility only.
Support will be dropped completely in a future release.</p>
</div>
<p>The following command line arguments are required. This list can be
accessed by running <code class="docutils literal"><span class="pre">“./NECSim</span> <span class="pre">-h”</span></code> or <code class="docutils literal"><span class="pre">./NECSim</span> <span class="pre">-help</span></code></p>
<p>As of version 3.6 and above, the command line options to be specified are:</p>
<ol class="arabic simple">
<li>the seed for the simulation.</li>
<li>the simulation task (for file reference).</li>
<li>the map config file.</li>
<li>the output directory.</li>
<li>the minimum speciation rate.</li>
<li>the dispersal z_fat value.</li>
<li>the dispersal L value.</li>
<li>the deme size.</li>
<li>the deme sample size.</li>
<li>the maximum simulation time (in seconds).</li>
<li>the lambda value for moving through non-habitat.</li>
<li>the temporal sampling file containing generation
values for sampling points in time (null for only sampling the
present)</li>
<li>the minimum number of species known to exist. (Currently has no
effect).</li>
<li>(and onwards) speciation rates to apply after simulation.</li>
</ol>
<p>In this format, the map config file and temporal sampling file are as described in <a class="reference internal" href="#config-files">Config Files</a>.</p>
<p>Alternatively, by specifying the -f flag, (full mode) as the first
argument, the program can read in pre-3.6 command line arguments, which
are as followed.</p>
<ol class="arabic simple">
<li>the task_iter used for setting the seed.</li>
<li>the sample grid x dimension</li>
<li>the sample grid y dimension</li>
<li>the fine map file relative path.</li>
<li>the fine map x dimension</li>
<li>the fine map y dimension</li>
<li>the fine map x offset</li>
<li>the fine map y offset</li>
<li>the coarse map file relative path.</li>
<li>the coarse map x dimension</li>
<li>the coarse map y dimension</li>
<li>the coarse map x offset</li>
<li>the coarse map y offset</li>
<li>the scale of the coarse map compared to the fine (10 means
resolution of coarse map = 10 x resolution of fine map)</li>
<li>the output directory</li>
<li>the speciation rate.</li>
<li>the dispersal sigma value.</li>
<li>the deme size</li>
<li>the deme sample size (as a proportion of deme size)</li>
<li>the time to run the simulation (in seconds).</li>
<li>lambda - the relative cost of moving through non-forest</li>
<li>the_task - for referencing the specific task later on.</li>
<li>the minimum number of species the system is known to contain.</li>
<li>the pristine fine map file to use</li>
<li>the pristine coarse map file to use</li>
<li>the rate of forest change from pristine</li>
<li>the time (in generations) since the pristine forest was seen.</li>
<li>the dispersal tau value (the width of the fat-tailed kernel).</li>
<li>the sample mask, with binary 1:0 values for areas that we want to
sample from. If this is not provided then this will default to
mapping the whole area.</li>
<li>the link to the file containing every generation that the list
should be expanded. This should be in the format of a list.</li>
<li>(and onwards) - speciation rates to apply after the simulation is
complete.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This method of running simulations is provided for legacy purposes only, and is no longer recommended. For
increase functionality, use the condensed command-line format, or switch to using config files.</p>
</div>
</div>
<div class="section" id="config-files">
<h3>Config Files<a class="headerlink" href="#config-files" title="Permalink to this headline">¶</a></h3>
<p>There are two separate config files which are used when setting up simulations.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference internal" href="#main-simulation-config-file">main simulation config file</a></dt>
<dd>Contains the main simulation parameters, including dispersal parameters, speciation rates, sampling information and
file referencing information. It also includes the paths to the other config files, which must be specified if the
main simulation config is used.
Contains the map parameters, including paths to the relevant map files, map dimensions, offsets and scaling. This
option cannot be null (map dimensions at least must be specified).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#time-config-file">time config file</a></dt>
<dd>Contains the temporal sampling points, in generations. If this is ‘null’, sampling will automatically occur only
at the present (generation time=0)</dd>
</dl>
</li>
</ul>
<p>When running the simulation using config files, the path to the <a class="reference internal" href="#main-simulation-config-file">main simulation config file</a> should be specified, e.g
<code class="docutils literal"><span class="pre">./NECSim</span> <span class="pre">-c</span> <span class="pre">/path/to/main/config.txt</span></code>.</p>
<div class="section" id="main-config-file">
<span id="main-simulation-config-file"></span><h4>Main Config File<a class="headerlink" href="#main-config-file" title="Permalink to this headline">¶</a></h4>
<p>The configuration containing the majority of the simulation set up, outside of map dimensions. An example file is shown
below. This file can be automatically generated by <a class="reference internal" href="PyCoalescence.html#PyCoalescence.coalescence.Coalescence.create_config" title="PyCoalescence.coalescence.Coalescence.create_config"><code class="xref py py-func docutils literal"><span class="pre">create_config()</span></code></a>
in PyCoalescence. An example of this configuration is given below:</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">main</span><span class="p">]</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">job_type</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">map_config</span> <span class="o">=</span> <span class="n">output</span><span class="o">/</span><span class="n">mapconf</span><span class="o">.</span><span class="n">txt</span>
<span class="n">output_directory</span> <span class="o">=</span> <span class="n">output</span>
<span class="n">min_spec_rate</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">deme</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">max_time</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">lambda</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time_config</span> <span class="o">=</span> <span class="n">output</span><span class="o">/</span><span class="n">tempconf</span><span class="o">.</span><span class="n">txt</span>
<span class="n">min_species</span> <span class="o">=</span> <span class="mi">1</span>

<span class="p">[</span><span class="n">spec_rates</span><span class="p">]</span>
<span class="n">spec_rate1</span>  <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">spec_rate2</span>  <span class="o">=</span> <span class="mf">0.8</span>
</pre></div>
</div>
</div>
<div class="section" id="map-config-options">
<span id="map-config-file"></span><h4>Map Config Options<a class="headerlink" href="#map-config-options" title="Permalink to this headline">¶</a></h4>
<p>The map options contain the information for setting up all maps required by the simulation. This involves maps at all
times and at all scales. An example is given below.</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">sample_grid</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">null</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">null</span>

<span class="p">[</span><span class="n">fine_map</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_fine</span><span class="o">.</span><span class="n">tif</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">x_off</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y_off</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">coarse_map</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_coarse</span><span class="o">.</span><span class="n">tif</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">41</span>
<span class="n">x_off</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">y_off</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="p">[</span><span class="n">pristine_fine0</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_fine_pristine1</span><span class="o">.</span><span class="n">tif</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="p">[</span><span class="n">pristine_coarse0</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_coarse_pristine1</span><span class="o">.</span><span class="n">tif</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="p">[</span><span class="n">pristine_fine1</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_fine_pristine2</span><span class="o">.</span><span class="n">tif</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="p">[</span><span class="n">pristine_coarse1</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">/</span><span class="n">SA_sample_coarse_pristine2</span><span class="o">.</span><span class="n">tif</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mf">0.7</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The rates and times between the pairs of pristine fine maps and pristine coarse maps must match up. Without matching
values here, there could be undetermined errors, or coarse map values being ignored.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pristine maps assume the same dimensions as their respective present-day equivalents.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In older versions of this program these options were contained in a separate file. However, as of 1.2.4 map and main
simulation options are contained in the same file.</p>
</div>
</div>
<div class="section" id="time-config-file">
<span id="id2"></span><h4>Time Config File<a class="headerlink" href="#time-config-file" title="Permalink to this headline">¶</a></h4>
<p>The temporal sampling config file (referred to as “time config file”) specifies times, in generations, when a full
sample according to the sample map should be taken again. An example of this file is given below.</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">main</span><span class="p">]</span>
<span class="n">time0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">time1</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For each speciation rate, all biodiversity measures (such as species’ abundances and species’ richness) will be
calculated for each time supplied separately.</p>
</div>
</div>
</div>
<div class="section" id="default-parameters">
<h3>Default parameters<a class="headerlink" href="#default-parameters" title="Permalink to this headline">¶</a></h3>
<p>To run the program with the default parameters for testing purposes, run
with the command line arguments -d or -dl (for the larger default run).
Note that this will require access to the following folders relative to
the path of the program for storing the outputs to the default runs:</p>
<p><strong>./Default</strong></p>
<p><strong>./Default/SQL_data/</strong></p>
</div>
</div>
</div>
<div class="section" id="outputs">
<h1>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h1>
<p>Upon successful completion of a simulation, the two files are created.</p>
<ul class="simple">
<li>A csv file is created called <em>Data_{the_task}_{the_seed}.csv</em> where the_seed and the_task are the values provided
in simulation set-up. This contains basic simulation information for quick reference.</li>
<li>an SQLite database file in the output directory in a folder called <em>SQL_data</em>.
This database contains all important simulation data over several tables, which can be accessed
using a program like <a class="reference external" href="http://sqlitebrowser.org/">DB Browser for SQLite</a> or Microsoft Access.
Alternatively, most programming languages have an SQLite interface
(<a class="reference external" href="https://cran.r-project.org/web/packages/RSQLite/index.html">RSQlite</a>,
<a class="reference external" href="https://docs.python.org/2/library/sqlite3.html">python sqlite3</a>)</li>
</ul>
<p>The tables in the SQLite database are
- SIMULATION_PARAMETERS</p>
<blockquote>
<div>contains the parameters the simulation was performed with for referencing later.</div></blockquote>
<ul>
<li><p class="first">SPECIES_LIST</p>
<blockquote>
<div><p>contains the locations of every coalescence event. This is used by SpeciationCounter to reconstruct the coalescence
tree for application of speciation rates after simulations are complete.</p>
</div></blockquote>
</li>
<li><p class="first">SPECIES_ABUNDANCES</p>
<blockquote>
<div><p>contains the species abundance distributions for each speciation rate and time point that has been specified.</p>
</div></blockquote>
</li>
<li><p class="first">SPECIES_LOCATIONS [optional]</p>
<blockquote>
<div><p>contains the x, y coordinates of every individual at each time point and for every specified speciation rate,
along with species ID numbers.</p>
</div></blockquote>
</li>
<li><p class="first">FRAGMENT_ABUNDANCES [optional]</p>
<blockquote>
<div><p>contains the species abundance distributions for each habitat fragment, either specified by the fragment csv file,
or detected from squares across the map.</p>
</div></blockquote>
</li>
</ul>
<p>Additional information can be found in <a class="reference internal" href="#speciationcounter">SpeciationCounter</a> regarding the optional database tables.</p>
</div>
<div class="section" id="speciationcounter">
<span id="introduction-speciationcounter"></span><h1>SpeciationCounter<a class="headerlink" href="#speciationcounter" title="Permalink to this headline">¶</a></h1>
<p>SpeciationCounter provides a method for applying additional speciation rates to outputs from NECSim, without having to
re-run the entire simulation. SpeciationCounter works by reconstructing the coalescence tree, checking at each point if
an additional speciation rate has occured. As such, SpeciationCounter can only apply speciation rates higher than the
initial speciation rate the program was run with.</p>
<div class="section" id="applying-speciation-rates">
<h2>Applying Speciation Rates<a class="headerlink" href="#applying-speciation-rates" title="Permalink to this headline">¶</a></h2>
<p>Run <code class="docutils literal"><span class="pre">./SpeciationCounter</span></code> with the following command-line options:</p>
<ol class="arabic">
<li><p class="first">path to the SQLite database file (this is the output of a NECSim simulation).</p>
</li>
<li><p class="first">T/F for recording spatial data. If true, the SPECIES_LOCATIONS table will be created (see <a class="reference internal" href="#outputs">Outputs</a>.)</p>
</li>
<li><p class="first">a sample mask to use for the data. Species’ identities for the individuals will only be calculated from locations
specified by a 1 in the sample mask (0 otherwise). Use “null” to record all locations.</p>
</li>
<li><p class="first">a <a class="reference internal" href="#time-config-file">time config file</a> specifying temporal sampling locations.</p>
</li>
<li><p class="first">T/F for calculating fragment species abundances individually. If true, the FRAGMENT_ABUNDANCES table will be created
containing the species abundances for each fragment calculated as a square of continuous habitat. Alternatively, can
specify a csv file that contains the fragment information in the following format. All x, y coordinates are given on
the sample grid size specified at simulation run-time.</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="n">fragment_name1</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">number_of_individuals</span>
<span class="n">fragment_name2</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">number_of_individuals</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">A speciation rate to apply. Can list multiple speciation rates by supplying arguments 7 onwards.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="debugging">
<h1>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h1>
<p>Most errors will return an error code in the form “ERROR_NAME_XXX:
Description” a list of which can be found in ERROR_REF.txt.</p>
</div>
<div class="section" id="brief-class-descriptions">
<h1>Brief Class Descriptions<a class="headerlink" href="#brief-class-descriptions" title="Permalink to this headline">¶</a></h1>
<p>A brief description of the important classes is given below. Some
classes also contain customised exceptions for better tracing of error
handling.</p>
<ul class="simple">
<li>The <a class="reference internal" href="Exhaled/class_Tree.html#_CPPv24Tree" title="Tree"><code class="xref cpp cpp-class docutils literal"><span class="pre">Tree</span></code></a> class<ul>
<li>The most important class!</li>
<li>Contains the main setup, run and data output routines.</li>
<li><a class="reference internal" href="Exhaled/class_Tree.html#_CPPv2N4Tree5setupEv" title="Tree::setup"><code class="xref cpp cpp-func docutils literal"><span class="pre">setup()</span></code></a> imports the data files from csv (if necessary) and creates
the in-memory objects for the storing of the coalescence tree and
the spatial grid of active lineages. Setup time mostly depends on
the size of the csv file being imported.</li>
<li>Run continually loops over sucessive coalesence, move or
speciation events until all individuals have speciated or
coalesced. This is where the majority of the simulation time will
be, and is mostly dependent on the number of individuals,
speciation rate and size of the spatial grid.</li>
<li>At the end of the simulation, the sqlCreate() routine will
generate the in-memory SQLite database for storing the coalescent
tree. It can run multiple times if multiple speciation rates are
required. <a class="reference internal" href="Exhaled/class_Tree.html#_CPPv2N4Tree10outputDataEv" title="Tree::outputData"><code class="xref cpp cpp-func docutils literal"><span class="pre">outputData()</span></code></a> will then be called to create a small csv
file containing important information, and output the SQLite
database to file if required.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_Treenode.html#_CPPv28Treenode" title="Treenode"><code class="xref cpp cpp-class docutils literal"><span class="pre">Treenode</span></code></a> class<ul>
<li>Contains a single record of a node on the phylogenetic tree, to be
used in reassembling the tree structure at the end of the
simulation.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_Datapoint.html#_CPPv29Datapoint" title="Datapoint"><code class="xref cpp cpp-class docutils literal"><span class="pre">Datapoint</span></code></a> class<ul>
<li>Contains a single record of the location of a lineage.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_NRrand.html#_CPPv26NRrand" title="NRrand"><code class="xref cpp cpp-class docutils literal"><span class="pre">NRrand</span></code></a> class<ul>
<li>Contains the random number generator, as written by James
Rosindell (<a class="reference external" href="mailto:j&#46;rosindell&#37;&#52;&#48;imperial&#46;ac&#46;uk">j<span>&#46;</span>rosindell<span>&#64;</span>imperial<span>&#46;</span>ac<span>&#46;</span>uk</a>).</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_Map.html#_CPPv23Map" title="Map"><code class="xref cpp cpp-class docutils literal"><span class="pre">Map</span></code></a> class<ul>
<li>Contains the routines for importing and calling values from the
map objects.</li>
<li>The <a class="reference internal" href="Exhaled/class_Map.html#_CPPv2N3Map6getValERKdRKdRKlRKlRKd" title="Map::getVal"><code class="xref cpp cpp-func docutils literal"><span class="pre">getVal()</span></code></a> and <a class="reference internal" href="Exhaled/class_Map.html#_CPPv2N3Map12runDispersalERKdRKdRlRlRlRlRbRKd" title="Map::runDispersal"><code class="xref cpp cpp-func docutils literal"><span class="pre">runDispersal()</span></code></a> functions can be modified
to produce altered dispersal behaviour, or alterations to the
structure of the <a class="reference internal" href="Exhaled/class_Row.html#_CPPv23Row" title="Row"><code class="xref cpp cpp-class docutils literal"><span class="pre">Row</span></code></a></li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_Matrix.html#_CPPv26Matrix" title="Matrix"><code class="xref cpp cpp-class docutils literal"><span class="pre">Matrix</span></code></a> and <a class="reference internal" href="Exhaled/class_Row.html#_CPPv23Row" title="Row"><code class="xref cpp cpp-class docutils literal"><span class="pre">Row</span></code></a> classes<ul>
<li>Based on code written by James Rosindell
(<a class="reference external" href="mailto:j&#46;rosindell&#37;&#52;&#48;imperial&#46;ac&#46;uk">j<span>&#46;</span>rosindell<span>&#64;</span>imperial<span>&#46;</span>ac<span>&#46;</span>uk</a>).</li>
<li>Handles indexing of the 2D object plus importing values from a csv
file.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_SpeciesList.html#_CPPv211SpeciesList" title="SpeciesList"><code class="xref cpp cpp-class docutils literal"><span class="pre">SpeciesList</span></code></a> class<ul>
<li>Contains the list of individuals, for application in a matrix, to
essentially create a 3D array.</li>
<li>Handles the positioning of individuals in space within a grid
cell.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_ConfigOption.html#_CPPv212ConfigOption" title="ConfigOption"><code class="xref cpp cpp-class docutils literal"><span class="pre">ConfigOption</span></code></a> class<ul>
<li>Contains basic functions for importing command line arguments from
a config file, providing an alternative way of setting up
simulations.</li>
</ul>
</li>
<li>The <a class="reference internal" href="Exhaled/class_Treelist.html#_CPPv28Treelist" title="Treelist"><code class="xref cpp cpp-class docutils literal"><span class="pre">Treelist</span></code></a> class<ul>
<li>Provides the routines for applying different speciation rates to a
phylogenetic tree, to be used either immediately after simulation
within NECSim, or at a later time using <a class="reference internal" href="#speciationcounter">SpeciationCounter</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="known-bugs">
<h1>Known Bugs<a class="headerlink" href="#known-bugs" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Simulations run until completion, rather than aiming for a desired
number of species. This is an intentional change. Functions related
to this functionality remain but are deprecated.</li>
<li>In SpeciationCounter, only continuous rectangular fragments are
properly calculated. Other shapes must be calculated by
post-processing.</li>
<li>In SpeciationCounter, 3 fragments instead of 2 will be calculated for
certain adjacent rectangular patches.</li>
</ul>
</div>
<div class="section" id="faqs-wip">
<h1>FAQS (WIP)<a class="headerlink" href="#faqs-wip" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><strong>Why doesn’t the default simulation output anything?</strong><ul>
<li>Check that the program has access to the folders relative to the
program at <cite>Default/</cite></li>
</ul>
</li>
<li><strong>Why can’t I compile the program?</strong><ul>
<li>This could be due to a number of reasons, most likely that you
haven’t compiled with access to the lsqlite3 or boost packages.
Installation and compilation differs across different systems; for
most UNIX systems, compiling with the linker arguments -lsqlite3
-lboost_filesystem and -lboost_system will solve problems with
the compiler not finding the sqlite or boost header file.</li>
<li>Another option could be the potential lack of access to the
fast-cpp-csv-parser by Ben Strasser, available
<a class="reference external" href="https://github.com/ben-strasser/fast-cpp-csv-parser">here</a>. If
use_csv has been defined at the head of the file, try without
use_csv or download the csv parser and locate the folder within
your working directory at compilation.</li>
</ul>
</li>
<li><strong>Every time the program runs I get error code XXX.</strong><ul>
<li>Check the ERROR_REF.txt file for descriptions of the files. Try compiling with the <cite>DEBUG</cite> precursor to gain
more information on the problem. It is most likely a problem with
the set up of the map data (error checking is not yet properly
implemented here).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="glossary">
<h1>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h1>
<dl class="glossary docutils">
<dt id="term-grid">grid</dt>
<dd>Used to refer to the simulation area that is stored in memory as a matrix, for quick referencing. If no RAM
optimisations have been performed, this will be the same as the sample map. If also no sample map is used, this
will be the same as the fine map.</dd>
<dt id="term-sample-map">sample map</dt>
<dd>The map file containing the points to be sampled from. This is the most zoomed in level of the simulation, and
should encompass all starting locations of lineages.</dd>
<dt id="term-fine-map">fine map</dt>
<dd>The map file at a higher resolution (the same as the sample grid) which covers the area lineages are most likely
to move to, or where a higher spatial resolution is considered important.</dd>
<dt id="term-coarse-map">coarse map</dt>
<dd>The map file at a lower resolution (specified by the scale) which covers a larger area than the fine map. This is
to allow lineages to move far from their starting positions if required.</dd>
<dt id="term-pristine-map">pristine map</dt>
<dd>A historic map containing population densities at those times. Both fine and coarse pristine maps can be declared
and multiple sets of pristine maps can be declared at unique times.</dd>
</dl>
</div>
<div class="section" id="version">
<h1>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h1>
<p>Version 1.2.5</p>
</div>
<div class="section" id="contacts">
<h1>Contacts<a class="headerlink" href="#contacts" title="Permalink to this headline">¶</a></h1>
<p>Author: <strong>Samuel Thompson</strong></p>
<p>Contact: <a class="reference external" href="mailto:samuelthompson14&#37;&#52;&#48;imperial&#46;ac&#46;uk">samuelthompson14<span>&#64;</span>imperial<span>&#46;</span>ac<span>&#46;</span>uk</a> - <a class="reference external" href="mailto:thompsonsed&#37;&#52;&#48;gmail&#46;com">thompsonsed<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
<p>Institution: Imperial College London and National University of
Singapore</p>
<p>Based heavily on code by <strong>James Rosindell</strong></p>
<p>Contact: <a class="reference external" href="mailto:j&#46;rosindell&#37;&#52;&#48;imperial&#46;ac&#46;uk">j<span>&#46;</span>rosindell<span>&#64;</span>imperial<span>&#46;</span>ac<span>&#46;</span>uk</a></p>
<p>Institution: Imperial College London</p>
</div>
<div class="section" id="licence">
<h1>Licence<a class="headerlink" href="#licence" title="Permalink to this headline">¶</a></h1>
<p>This project is released under BSD-3 See file
<strong>LICENSE.txt</strong> or go to
<a class="reference external" href="https://opensource.org/licenses/BSD-3-Clause">here</a> for full license
details.</p>
<p>You are free to modify and distribute the code for any non-commercial purpose.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/PyCoal_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#a-note-on-the-neutral-theory-of-ecology">A Note on the Neutral Theory of Ecology</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instructions">Instructions</a><ul>
<li><a class="reference internal" href="#compiling-the-program">Compiling the program</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#compiler-options">Compiler Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-simulations">Running simulations</a><ul>
<li><a class="reference internal" href="#command-line-arguments">Command Line Arguments</a></li>
<li><a class="reference internal" href="#config-files">Config Files</a><ul>
<li><a class="reference internal" href="#main-config-file">Main Config File</a></li>
<li><a class="reference internal" href="#map-config-options">Map Config Options</a></li>
<li><a class="reference internal" href="#time-config-file">Time Config File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-parameters">Default parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#outputs">Outputs</a></li>
<li><a class="reference internal" href="#speciationcounter">SpeciationCounter</a><ul>
<li><a class="reference internal" href="#applying-speciation-rates">Applying Speciation Rates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
<li><a class="reference internal" href="#brief-class-descriptions">Brief Class Descriptions</a></li>
<li><a class="reference internal" href="#known-bugs">Known Bugs</a></li>
<li><a class="reference internal" href="#faqs-wip">FAQS (WIP)</a></li>
<li><a class="reference internal" href="#glossary">Glossary</a></li>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#contacts">Contacts</a></li>
<li><a class="reference internal" href="#licence">Licence</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/README_NECSim.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyCoalescence 1.2.5 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Samuel Thompson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.4.
    </div>
  </body>
</html>