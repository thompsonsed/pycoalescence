<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pycoalescence &#8212; pycoalescence 1.2.6 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script type="text/javascript" src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="shortcut icon" href="_static/PyCoal_favicon_large.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="necim" href="necsim/necsim_library.html" />
    <link rel="prev" title="Welcome to pycoalescence" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="necsim/necsim_library.html" title="necim"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to pycoalescence"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pycoalescence 1.2.6 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pycoalescence">
<h1>pycoalescence<a class="headerlink" href="#pycoalescence" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><strong>pycoalescence</strong> is a python module for the spatially-explicit coalescence neutral simulator, described
<a class="reference internal" href="necsim/necsim_library.html#introduction-necsim"><span class="std std-ref">here</span></a>. <strong>pycoalescence</strong> provides a pythonic interface for setting up, running and analysing
spatially-explicit neutral simulations. It allows for a swift and clean creation management of simulations.</p>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<p>A large number of performance-enhancing features have been implemented, as well as support for a wide number of
scenarios. The features include:</p>
<ul class="simple">
<li>Coalescence methods for excellent performance.</li>
<li>Full output of community structure, with species IDs generated for every individual.</li>
<li>Full spatial modelling, using a dispersal kernel to simulate spatial dynamics.</li>
<li>Multiple sampling points, both spatially and temporally.</li>
<li>Simulations of a region much larger than the sample area.</li>
<li>Calculation of many biodiversity metrics, including species richness, species abundances, beta-diversity and
locations of lineages.</li>
<li>Scalability - support for simulations of tens or hundreds of millions of individuals in a single simulation.</li>
</ul>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id2">Installation</a></li>
<li><a class="reference internal" href="#performing-simulations" id="id3">Performing simulations</a></li>
<li><a class="reference internal" href="#post-simulation-analysis" id="id4">Post-simulation analysis</a></li>
<li><a class="reference internal" href="#extended-analysis" id="id5">Extended analysis</a></li>
<li><a class="reference internal" href="#extended-features" id="id6">Extended Features</a></li>
<li><a class="reference internal" href="#testing-install" id="id7">Testing install</a></li>
</ul>
</div>
<div class="section" id="installation">
<h3><a class="toc-backref" href="#id2">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Currently, only macOS and linux-based operating systems are supported. Windows compatibility will likely be added at a
later date.</p>
<div class="section" id="method">
<h4>Method<a class="headerlink" href="#method" title="Permalink to this headline">¶</a></h4>
<p>Before attempting installation, make sure the <a class="reference internal" href="#prerequisites">prerequisites are installed</a>. There are a few options for installation.</p>
<ul>
<li><p class="first">Use in-built installation <strong>[recommended]</strong></p>
<blockquote>
<div><ul class="simple">
<li>Simply run <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></code> from the terminal.</li>
<li>You can also run <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">[opts]</span></code> where <code class="docutils literal"><span class="pre">[opts]</span></code> are
your required compilation flags (see  <a class="reference internal" href="#compilation-options">Compilation Options</a>). On some systems this requires that <code class="docutils literal"><span class="pre">autoconf</span></code> and
<code class="docutils literal"><span class="pre">autotools</span></code> are installed on your computer.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Use <a class="reference internal" href="pycoalescence.html#module-pycoalescence.setup" title="pycoalescence.setup"><code class="xref py py-mod docutils literal"><span class="pre">setup.py</span></code></a> to customise options and install locations. The procedure is the same
as exists in <code class="xref py py-func docutils literal"><span class="pre">main()</span></code>.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="c1"># Replace with desired install options</span>
<span class="n">setup</span><span class="o">.</span><span class="n">run_configure</span><span class="p">([</span><span class="s2">&quot;--with-hpc&quot;</span><span class="p">,</span> <span class="s2">&quot;--with-verbose&quot;</span><span class="p">])</span>
<span class="c1"># This compiles the c++ code in the lib folder to lib/obj for .o files the package directory</span>
<span class="c1"># and build/sharedpy2 or build/sharedpy3 for .so files (depending on python version)</span>
<span class="n">setup</span><span class="o">.</span><span class="n">do_compile</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Run <code class="docutils literal"><span class="pre">./configure</span></code> and <code class="docutils literal"><span class="pre">make</span></code> yourself.</p>
<blockquote>
<div><p>If you require additional compilation options, run <code class="docutils literal"><span class="pre">./configure</span></code> with your options from the lib/ directory. Then
run <code class="docutils literal"><span class="pre">make</span></code> and check that installation is complete. The shared object file should be moved into the <em>build/sharedpyx</em>
directory, where <em>x</em> is the major python version number (2 or 3).</p>
</div></blockquote>
</li>
<li><p class="first">Custom compilation</p>
<blockquote>
<div><p>Compile the c++ files yourself with the required defines and copy the executable to the required directory.</p>
</div></blockquote>
</li>
</ul>
<p>For HPC use, running <code class="docutils literal"><span class="pre">python</span> <span class="pre">hpc_setup.py</span></code> (see <a class="reference internal" href="pycoalescence.html#module-pycoalescence.hpc_setup" title="pycoalescence.hpc_setup"><code class="xref py py-mod docutils literal"><span class="pre">hpc_setup</span></code></a>) will perform
compilation for an HPC using the intel compiler and copy the executable to &#8221;../../Code&#8221; relative to pycoalescence.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Additional steps may have to be taken to ensure availability of the correct packages on HPC systems. Check
with your HPC administrator for details.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Separate compiles of the program are usually required for each python installation and virtual environment.
This can cause complications for certain IDEs. If you encounter problems, it is recommended that you run
<code class="docutils literal"><span class="pre">setup.py</span></code> from within you IDE.</p>
</div>
</div>
<div class="section" id="compilation-options">
<span id="sec-compilation-options"></span><h4>Compilation Options<a class="headerlink" href="#compilation-options" title="Permalink to this headline">¶</a></h4>
<p>These are the possible flags which can be provided during installation as options in <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">[opts]</span></code>. It is
not usually expected that you need to provide any of these options.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8211;with-debug</td>
<td>Adds additional debugging information, including writing all messages to a log file.</td>
</tr>
<tr class="row-odd"><td>&#8211;with-gdal=DIR</td>
<td>Define a gdal library at DIR</td>
</tr>
<tr class="row-even"><td>&#8211;with-hpc</td>
<td>Compile ready for HPC, using intel&#8217;s icpc compilation and a variety of optimisation flags.</td>
</tr>
<tr class="row-odd"><td>&#8211;with-boost=DIR</td>
<td>Define a boost library at DIR</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="performing-simulations">
<span id="id1"></span><h3><a class="toc-backref" href="#id3">Performing simulations</a><a class="headerlink" href="#performing-simulations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setting-up-simulations">
<h4>Setting up simulations<a class="headerlink" href="#setting-up-simulations" title="Permalink to this headline">¶</a></h4>
<p>There are two methods for providing configuration options in pycoalescence. Both require the same initial procedure.
The recommended method is:</p>
<ol class="arabic">
<li><p class="first">Specify simulation parameters</p>
<ul>
<li><p class="first">Use <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_simulation_params" title="pycoalescence.simulation.Simulation.set_simulation_params"><code class="xref py py-func docutils literal"><span class="pre">set_simulation_params()</span></code></a>
to set the job number, task number, output directory and other key simulation variables.</p>
</li>
<li><p class="first">Set the map variables by one of the following:</p>
<ol class="loweralpha simple">
<li><code class="xref py py-func docutils literal"><span class="pre">set_map_parameters()</span></code> to input file paths and dimensions</li>
<li><a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_map_files" title="pycoalescence.simulation.Simulation.set_map_files"><code class="xref py py-func docutils literal"><span class="pre">set_map_files()</span></code></a> to set the map file paths. This
calls <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.detect_map_dimensions" title="pycoalescence.simulation.Simulation.detect_map_dimensions"><code class="xref py py-func docutils literal"><span class="pre">detect_map_dimensions()</span></code></a> to automatically
detect file offsets and dimensions.</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Check <a class="reference internal" href="#limitations-of-simulation-variables">Limitations of simulation variables</a> for important information on restrictions on simulation
inputs.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.detect_map_dimensions" title="pycoalescence.simulation.Simulation.detect_map_dimensions"><code class="xref py py-func docutils literal"><span class="pre">detect_map_dimensions()</span></code></a> requires
that the files are in <strong>.tif</strong> formats so that file dimensions can be read. If input files are csv format,
method a) should be used.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">One can specify either &#8220;null&#8221; or &#8220;none&#8221; map types; &#8220;null&#8221; creates a map at the specified
size, whereas &#8220;none&#8221; creates hard boundaries without any in-memory map object created at all. However,
the dimensions of these files must be manually supplied.</p>
</div>
</li>
<li><p class="first">Optionally, also run <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_speciation_rates" title="pycoalescence.simulation.Simulation.set_speciation_rates"><code class="xref py py-func docutils literal"><span class="pre">set_speciation_rates()</span></code></a>
to set a list of speciation rates to apply at the end of the simulation.</p>
</li>
</ul>
</li>
<li><p class="first">Finalise setup</p>
<ul class="simple">
<li>Run <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.finalise_setup" title="pycoalescence.simulation.Simulation.finalise_setup"><code class="xref py py-func docutils literal"><span class="pre">finalise_setup()</span></code></a> to check that simulations are
setup, generate the command to be passed to <a class="reference internal" href="necsim/necsim_library.html#introduction-necsim"><span class="std std-ref">necsim</span></a> and create any required config files.</li>
</ul>
</li>
<li><p class="first">Run simulations</p>
<ul class="simple">
<li>Finally, start the simulation using <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.run_coalescence" title="pycoalescence.simulation.Simulation.run_coalescence"><code class="xref py py-func docutils literal"><span class="pre">run_coalescence()</span></code></a></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="custom-configuration-files">
<h4>Custom Configuration Files<a class="headerlink" href="#custom-configuration-files" title="Permalink to this headline">¶</a></h4>
<p>Although not recommended for most use-cases, it is possible to manually create a configuration file, instead of relying on
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.finalise_setup" title="pycoalescence.simulation.Simulation.finalise_setup"><code class="xref py py-func docutils literal"><span class="pre">finalise_setup()</span></code></a> to do it for you. This may be useful if
you want to store the setup file in a particular place. The process is outlined below. There are two general configuration
files, which as default are mainconf_*job_num*_*seed*.txt and the other as timeconf_*job_num*_*seed*.txt.</p>
<ol class="arabic">
<li><p class="first">Add a temporal sampling configuration file
If you require sampling at points other than the present day, these can be specified in another configuration file.</p>
<ul class="simple">
<li>Add temporal sampling points using <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.add_sample_time" title="pycoalescence.simulation.Simulation.add_sample_time"><code class="xref py py-func docutils literal"><span class="pre">add_sample_time()</span></code></a>
Multiple sample points can be added.</li>
<li>Create the temporal sampling config file (<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_temporal_sampling_config" title="pycoalescence.simulation.Simulation.create_temporal_sampling_config"><code class="xref py py-func docutils literal"><span class="pre">create_temporal_sampling_config()</span></code></a>)</li>
</ul>
</li>
<li><p class="first">Generate the main config file
Run <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_config" title="pycoalescence.simulation.Simulation.create_config"><code class="xref py py-func docutils literal"><span class="pre">create_config()</span></code></a> to generate the main config file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you wish to use multiple map files or multiple temporal samples and wish to use a main config file as well,
you must call
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_config" title="pycoalescence.simulation.Simulation.create_config"><code class="xref py py-func docutils literal"><span class="pre">create_config()</span></code></a> <strong>after</strong> both
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_map_config" title="pycoalescence.simulation.Simulation.create_map_config"><code class="xref py py-func docutils literal"><span class="pre">create_map_config()</span></code></a> and
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_temporal_sampling_config" title="pycoalescence.simulation.Simulation.create_temporal_sampling_config"><code class="xref py py-func docutils literal"><span class="pre">create_temporal_sampling_config()</span></code></a></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is possible to use temporal config files without using a main config file. However,
if you want map or main options in config file, you <strong>must</strong> use all config options (main config and temporal config).</p>
</div>
</li>
<li><p class="first">Add map configuration options
If you require multiple map files at different points in time, you shall need to create a configuration (.txt or .cfg)
file to make these options accessible to the program.</p>
<p>These configuration options appear in the main configuration file under various headings.</p>
<ul class="simple">
<li>First add the historical map options using <code class="xref py py-func docutils literal"><span class="pre">add_historical_map()</span></code>
This can be performed multiple times to add several maps.</li>
<li>Add the options to the configuration file (<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.create_map_config" title="pycoalescence.simulation.Simulation.create_map_config"><code class="xref py py-func docutils literal"><span class="pre">create_map_config()</span></code></a>)</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See <a class="reference internal" href="#glossary">Glossary</a> for definitions of <a class="reference internal" href="#term-sample-map"><span class="xref std std-term">sample map</span></a>, <a class="reference internal" href="#term-fine-map"><span class="xref std std-term">fine map</span></a> and <a class="reference internal" href="#term-coarse-map"><span class="xref std std-term">coarse map</span></a>.</p>
</div>
</div>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<p>A simple simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">Simulation</span>
<span class="c1"># Set logging level to &quot;info&quot; (from logging module)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># set the main simulation parameters - use default values for other keyword arguments</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_simulation_params</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">min_speciation_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">deme</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Optionally add a set of speciation rates to apply at the end of the simulation</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_speciation_rates</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="c1"># set the map parameters - null means the map will be generated with 100% cover everywhere (no file input).</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_map_parameters</span><span class="p">(</span><span class="n">sample_file</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">sample_x</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">sample_y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                     <span class="n">fine_file</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">fine_x</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">fine_y</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">fine_x_offset</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">fine_y_offset</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">coarse_file</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">coarse_x</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">coarse_y</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                     <span class="n">coarse_x_offset</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">coarse_y_offset</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">coarse_scale</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">historical_fine_map</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">historical_coarse_map</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span><span class="p">)</span>
<span class="c1"># complete setup and run simulation</span>
<span class="n">c</span><span class="o">.</span><span class="n">finalise_setup</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">run_coalescence</span><span class="p">()</span>
</pre></div>
</div>
<p>A more complex example using config files, multiple temporal sampling points and detection of map dimensions from the
inputted map files.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">Simulation</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
<span class="c1"># set the main simulation parameters</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_simulation_params</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">min_speciation_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">deme</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mf">0.1</span>
                        <span class="n">max_time</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dispersal_method</span><span class="o">=</span><span class="s2">&quot;fat-tailed&quot;</span><span class="p">,</span> <span class="n">m_prob</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">dispersal_relative_cost</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_num_species</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">forest_change_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                        <span class="n">historical_forest_time</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">time_config_file</span><span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">restrict_self</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">infinite_landscape</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># Add a set of speciation rates to be applied at the end of the simulation</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_speciation_rates</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="c1"># set the map files</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_map_files</span><span class="p">(</span><span class="n">sample_file</span><span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">fine_file</span><span class="o">=</span><span class="s2">&quot;path/to/fine.tif&quot;</span><span class="p">,</span> <span class="n">coarse_file</span><span class="o">=</span><span class="s2">&quot;path/to/coarse.tif&quot;</span><span class="p">)</span>
<span class="c1"># add sample times</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_sample_time</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_sample_time</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># add historical maps</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_historical_map</span><span class="p">(</span><span class="n">fine_map</span><span class="o">=</span><span class="s2">&quot;path/to/historicalfine1.tif&quot;</span><span class="p">,</span> <span class="n">coarse_map</span><span class="o">=</span><span class="s2">&quot;path/to/historicalcoarse1.tif&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># create configuration files, run the checks and finalise the simulation</span>
<span class="n">c</span><span class="o">.</span><span class="n">finalise_setup</span><span class="p">()</span>
<span class="c1"># run the simulation</span>
<span class="n">c</span><span class="o">.</span><span class="n">run_coalescence</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">necsim can also be run directly using command line arguments (see
<a class="reference internal" href="necsim/necsim_library.html#introduction-necsim"><span class="std std-ref">Introduction to necsim</span></a>).</p>
</div>
<p>Example configuration file</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">sample_grid</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">Maps</span><span class="o">/</span><span class="n">maskmap</span><span class="o">.</span><span class="n">tif</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">486</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">517</span>
<span class="n">mask</span> <span class="o">=</span> <span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">Maps</span><span class="o">/</span><span class="n">maskmap</span><span class="o">.</span><span class="n">tif</span>

<span class="p">[</span><span class="n">fine_map</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">Maps</span><span class="o">/</span><span class="n">finemap</span><span class="o">.</span><span class="n">tif</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">34000</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">28000</span>
<span class="n">x_off</span> <span class="o">=</span> <span class="mi">17155</span>
<span class="n">y_off</span> <span class="o">=</span> <span class="mi">11178</span>

<span class="p">[</span><span class="n">coarse_map</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">Maps</span><span class="o">/</span><span class="n">coarsemap</span><span class="o">.</span><span class="n">tif</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">24000</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">x_off</span> <span class="o">=</span> <span class="mi">10320</span>
<span class="n">y_off</span> <span class="o">=</span> <span class="mi">7200</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="p">[</span><span class="n">historical_fine0</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">historical_coarse0</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">historical_fine1</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">historical_coarse1</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">dispersal</span><span class="p">]</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">norm</span><span class="o">-</span><span class="n">uniform</span>
<span class="n">m_probability</span> <span class="o">=</span> <span class="mf">1e-10</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">restrict_self</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">infinite_landscape</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">main</span><span class="p">]</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">job_type</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">map_config</span> <span class="o">=</span> <span class="n">output</span><span class="o">/</span><span class="n">mainconf_2_1</span><span class="o">.</span><span class="n">txt</span>
<span class="n">output_directory</span> <span class="o">=</span> <span class="n">output</span><span class="o">/</span>
<span class="n">min_spec_rate</span> <span class="o">=</span> <span class="mf">1e-05</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">deme</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">max_time</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">dispersal_relative_cost</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">time_config</span> <span class="o">=</span> <span class="n">null</span>
<span class="n">min_species</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="dispersal-kernels">
<h4>Dispersal Kernels<a class="headerlink" href="#dispersal-kernels" title="Permalink to this headline">¶</a></h4>
<p>Three different dispersal functions are currently supported, which take some combination of the <em>sigma</em> (<span class="math">\(\sigma\)</span>)
, <em>tau</em> (<span class="math">\(\tau\)</span> ), <em>m_prob</em> (<span class="math">\(m\)</span> ) and <em>cutoff</em> (<span class="math">\(c\)</span> ) dispersal parameters. You only need to provide
the required parameters for each dispersal method; any additional parameters provided will be ignored.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Normal distribution (the default)</dt>
<dd>This requires <span class="math">\(\sigma\)</span> only (the standard deviation). The outputted dispersal kernel in two dimensions
will follow a Rayleigh distribution for dispersal distance, <span class="math">\(N(r)\)</span></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Fat-tailed distribution</dt>
<dd>This requires both <span class="math">\(\sigma\)</span> and <span class="math">\(\tau\)</span>. Importantly, for our fat-tailed dispersal kernel, <span class="math">\(F(r)\)</span>,
<span class="math">\(\lim{\tau \to \inf} = N(r)\)</span>. Within this dispersal kernel, there is an increased chance of long-distance
dispersal (but lower than the normal-uniform dispersal kernel).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Normal-uniform distribution</dt>
<dd>This requires <span class="math">\(\sigma\)</span>, <span class="math">\(m\)</span> and <span class="math">\(c\)</span> . Here, we pick with probability <span class="math">\(1-m\)</span> from a normal
distribution with standard deviation <span class="math">\(\sigma\)</span>, and probability <span class="math">\(m\)</span> from a uniform distribution. This
uniform distribution picks a random distance uniformly between 0 and <span class="math">\(c\)</span>, the maximal dispersal distance. For
very large <span class="math">\(c\)</span>, extremely long distance dispersal is possible.</dd>
</dl>
</li>
</ul>
<p>It is also possible to provide a dispersal probability map, which sets the probability of dispersing from one cell to
another. The dispersal map should be dimensions <em>xy</em> by <em>xy</em> where <em>x</em> and <em>y</em> are the dimensions of the fine map. A
dispersal map can be set by using
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_map_files" title="pycoalescence.simulation.Simulation.set_map_files"><code class="xref py py-func docutils literal"><span class="pre">set_map_files(dispersal_map=&quot;/path/to/dispersal.tif&quot;)</span></code></a>.</p>
<p><strong>pycoalescence</strong> has the ability to simulate a dispersal kernel on a landscape. For more information about that
process, see <a class="reference internal" href="README_landscapes.html#simulate-landscapes"><span class="std std-ref">here</span></a></p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">In this scenario, it is not possible to use a coarse map, which should be &#8220;none&#8221;.</p>
</div>
</div>
<div class="section" id="differing-reproductive-rates">
<h4>Differing reproductive rates<a class="headerlink" href="#differing-reproductive-rates" title="Permalink to this headline">¶</a></h4>
<p>Simulations can use varying reproductive rates across the landscape, but using
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_map_files" title="pycoalescence.simulation.Simulation.set_map_files"><code class="xref py py-func docutils literal"><span class="pre">set_map_files(reproduction_map=&quot;/path/to/rep.tif&quot;)</span></code></a>. In this
scenario, all species have different per-capita reproduction rates across the landscape.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Density is already taken into account during simulations for reproduction rates, so the reproduction map
should be solely for the <em>per-capita</em> differences in reproductive rate.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A reproduction map can only be used with a fine map, and coarse map should be set to &#8220;none&#8221;.</p>
</div>
</div>
<div class="section" id="limitations-of-simulation-variables">
<h4>Limitations of simulation variables<a class="headerlink" href="#limitations-of-simulation-variables" title="Permalink to this headline">¶</a></h4>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This section contains key information about the simulation inputs. Please read carefully to minimise any
unnecessary bugs.</p>
</div>
<p>Certain simulation variables have limitations, depending on the method of setting up the simulation.</p>
<ul>
<li><p class="first">Map variables set up using <code class="xref py py-func docutils literal"><span class="pre">set_map_parameters()</span></code></p>
<blockquote>
<div><ul class="simple">
<li>Sample map dimensions must be smaller than fine map dimensions.</li>
<li>Fine map dimensions must be smaller than coarse map dimensions (supplied at the resolution of the fine map files).</li>
<li>Dimensions of historical fine and coarse maps must match their respective current map dimensions.</li>
<li>All offsets must maintain the smaller map within the larger map</li>
<li>If any files are supplied as &#8216;null&#8217;, map sizes must still be provided. This is important for sample map size, but
should be corrected in a future update for coarse map files.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Map files (and variables) set using <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_map_files" title="pycoalescence.simulation.Simulation.set_map_files"><code class="xref py py-func docutils literal"><span class="pre">set_map_files()</span></code></a></p>
<blockquote>
<div><ul class="simple">
<li>In addition to the above conditions being true, the files must all be georeferenced, so that coarse and fine map
dimensions will be read correctly.</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Use a GIS program (such as ArcGIS or QGIS) for manipulation of map files to
ensure georeferencing is preserved.</p>
</div>
<ul class="simple">
<li>If the samplemask map is &#8220;null&#8221;, the program will read the dimensions from the fine map and choose that as the
area to sample entirely over. Supplying &#8220;null&#8221; will therefore sample the entirety of the fine map.</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Scalings and offsets between maps should also work correctly, but if problems are encountered, try manually
specifying offsets and dimensions to identify any problems.</p>
</div>
<ul class="simple">
<li>Both the reproduction map and dispersal map (if provided) must match the dimensions of the fine map. No coarse map
should be provided in either scenario.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>An example of how the map files are related is shown below. Black arrows indicate the offsets for the fine map (in the x
and y dimensions) and purple arrows indicate the offsets for the coarse map.</p>
<img alt="Example sample map, fine map and coarse map" src="_images/grid_sample.png" />
</div>
<div class="section" id="infinite-landscapes">
<h4>Infinite Landscapes<a class="headerlink" href="#infinite-landscapes" title="Permalink to this headline">¶</a></h4>
<p>Simulations can also be run on infinite landscapes. Set <code class="docutils literal"><span class="pre">infinite_landscapes=opt</span></code> in
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_simulation_params" title="pycoalescence.simulation.Simulation.set_simulation_params"><code class="xref py py-func docutils literal"><span class="pre">set_simulation_params()</span></code></a> where <em>opt</em> is one of the
following:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>&#8220;closed&#8221; (default)</dt>
<dd>Run without infinite landscapes, with closed boundaries to the coarse map.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;infinite&#8221;</dt>
<dd>Run with a historical infinite landscape outside of the coares map boundaries.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;tiled_coarse&#8221;</dt>
<dd>Tile the coarse map infinitely in all dimensions. A coarse map must be provided.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;tiled_fine&#8221;</dt>
<dd>Tile the fine map infinitely in all dimensions. No coarse map should be provided.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="optimising-simulations">
<h4>Optimising Simulations<a class="headerlink" href="#optimising-simulations" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.optimise_ram" title="pycoalescence.simulation.Simulation.optimise_ram"><code class="xref py py-func docutils literal"><span class="pre">optimise_ram()</span></code></a> exists for reducing the RAM requirements of
a simulation. Running the function with a specific RAM limit, in GB, should choose a sample map size and offsets to
minimise the in-memory object sizes. This may have a minor impact on simulation speed, but this is likely negligible.
After the function is run, the <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation" title="pycoalescence.simulation.Simulation"><code class="xref py py-class docutils literal"><span class="pre">Simulation</span> <span class="pre">class</span></code></a> should have re-defined
the grid x and y dimensions to be the largest size possible to simulate for the required memory. The sample map offsets
from the grid are then also stored, such that the grid encompasses the area with the highest number of individuals.</p>
<p><a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.optimise_ram" title="pycoalescence.simulation.Simulation.optimise_ram"><code class="xref py py-func docutils literal"><span class="pre">optimise_ram()</span></code></a> may take some time to run. However, for a
single set of simulations with the same RAM limit, this function should only need to be completed once. Getting and
setting the optimised solution is therefore possible with
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.get_optimised_solution" title="pycoalescence.simulation.Simulation.get_optimised_solution"><code class="xref py py-func docutils literal"><span class="pre">get_optimised_solution()</span></code></a> and
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.set_optimised_solution" title="pycoalescence.simulation.Simulation.set_optimised_solution"><code class="xref py py-func docutils literal"><span class="pre">set_optimised_solution()</span></code></a>. The whole procedure is
outlined below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Detect the RAM-optimised solution</span>
<span class="o">&gt;&gt;</span> <span class="n">sim1</span><span class="o">.</span><span class="n">optimise_ram</span><span class="p">()</span>
<span class="c1"># Get the optimised solution for Simulation object sim1</span>
<span class="o">&gt;&gt;</span> <span class="n">sim1</span><span class="o">.</span><span class="n">get_optimised_solution</span><span class="p">()</span>
<span class="p">{</span><span class="s1">&#39;grid_file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span>
<span class="s1">&#39;grid_x_size&#39;</span><span class="p">:</span> <span class="mi">5134</span><span class="p">,</span>
<span class="s1">&#39;grid_y_size&#39;</span><span class="p">:</span> <span class="mi">5134</span><span class="p">,</span>
<span class="s1">&#39;sample_x_offset&#39;</span><span class="p">:</span> <span class="mi">8208</span><span class="p">,</span>
<span class="s1">&#39;sample_y_offset&#39;</span><span class="p">:</span> <span class="mi">14877</span><span class="p">}</span>
<span class="c1"># Now set the optimised solution for Simulation object sim2</span>
<span class="o">&gt;&gt;</span> <span class="n">sim2</span><span class="o">.</span><span class="n">set_optimised_solution</span><span class="p">({</span><span class="s1">&#39;grid_file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;grid_x_size&#39;</span><span class="p">:</span> <span class="mi">5134</span><span class="p">,</span>
                              <span class="s1">&#39;grid_y_size&#39;</span><span class="p">:</span> <span class="mi">5134</span><span class="p">,</span>
                              <span class="s1">&#39;sample_x_offset&#39;</span><span class="p">:</span> <span class="mi">8208</span><span class="p">,</span>
                              <span class="s1">&#39;sample_y_offset&#39;</span><span class="p">:</span> <span class="mi">14877</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="post-simulation-analysis">
<h3><a class="toc-backref" href="#id4">Post-simulation analysis</a><a class="headerlink" href="#post-simulation-analysis" title="Permalink to this headline">¶</a></h3>
<p>Once simulations are complete, necsim&#8217;s <a class="reference internal" href="necsim/necsim_library.html#introduction-speciationcounter"><span class="std std-ref">applying speciation rates functionality</span></a>
can be used to apply additional speciation rates to the coalescence tree. A simple way of applying additional simulation
rates is provided within the <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree" title="pycoalescence.coalescence_tree.CoalescenceTree"><code class="xref py py-class docutils literal"><span class="pre">CoalescenceTree</span> <span class="pre">class</span></code></a>.</p>
<p>The two functions for this routine are</p>
<ul class="simple">
<li><a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.set_speciation_params" title="pycoalescence.coalescence_tree.CoalescenceTree.set_speciation_params"><code class="xref py py-func docutils literal"><span class="pre">set_speciation_params()</span></code></a> which takes as</li>
</ul>
<blockquote>
<div><p>arguments</p>
<blockquote>
<div><ul class="simple">
<li>the SQL database file containing a finished simulation</li>
<li>T/F of recording full spatial data</li>
<li>either a csv file containing fragment data, or T/F for whether
fragments should be calculated from squares of continuous habitat.
* list of speciation rates to apply</li>
<li>[optional] a sample file to specify certain cells to sample from</li>
<li>[optional] a config file containing the temporal sampling points
desired.</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.apply_speciation" title="pycoalescence.coalescence_tree.CoalescenceTree.apply_speciation"><code class="xref py py-func docutils literal"><span class="pre">apply_speciation()</span></code></a> performs the analysis.
This can be extremely RAM and time-intensive for simulations of a large number of individuals. The calculations will
be stored in extra tables within the same SQL file as originally
specified.</li>
</ul>
<p>The procedure for applying additional speciation rates to an existing database is</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">CoalescenceTree</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">CoalescenceTree</span><span class="p">()</span>
<span class="n">speciation_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>
<span class="n">t</span><span class="o">.</span><span class="n">set_database</span><span class="p">(</span><span class="s2">&quot;output/SQL_data/data_1_1.db&quot;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">set_speciation_params</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="n">speciation_rates</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">apply_speciation</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree" title="pycoalescence.coalescence_tree.CoalescenceTree"><code class="xref py py-class docutils literal"><span class="pre">CoalescenceTree</span> <span class="pre">class</span></code></a> object can also be set up from a
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation" title="pycoalescence.simulation.Simulation"><code class="xref py py-class docutils literal"><span class="pre">Simulation</span> <span class="pre">class</span></code></a> object as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycoalescence</span> <span class="kn">import</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">CoalescenceTree</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
<span class="c1"># ... set up simulation here, then run</span>
<span class="c1"># Now import our completed simulation without needing to run t.set_database(&quot;filepath&quot;)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">CoalescenceTree</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
</pre></div>
</div>
<p>A few biodiversity metrics can then be obtained directly from the database using built-in functions, relieving the user
of having to generate these manually. These include</p>
<ul class="simple">
<li>species richness, using <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.get_richness" title="pycoalescence.coalescence_tree.CoalescenceTree.get_richness"><code class="xref py py-func docutils literal"><span class="pre">get_richness()</span></code></a></li>
<li>species abundances, using <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.get_species_abundances" title="pycoalescence.coalescence_tree.CoalescenceTree.get_species_abundances"><code class="xref py py-func docutils literal"><span class="pre">get_species_abundances()</span></code></a></li>
<li>species octave (2^n) classes for generating species abundance distributions,
using <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.get_octaves" title="pycoalescence.coalescence_tree.CoalescenceTree.get_octaves"><code class="xref py py-func docutils literal"><span class="pre">get_octaves()</span></code></a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above functions require supplying a speciation rate and time, otherwise will output data for all
speciation rates and times.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Equivalent functions also exist for obtaining individual fragment biodiversity metrics.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The entire list of species can be outputted using
<a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.get_species_list" title="pycoalescence.coalescence_tree.CoalescenceTree.get_species_list"><code class="xref py py-func docutils literal"><span class="pre">get_species_list</span></code></a>. This may be useful for scenarios
where it is desirable to calculate custom biodiversity metrics.</p>
</div>
</div>
<div class="section" id="extended-analysis">
<h3><a class="toc-backref" href="#id5">Extended analysis</a><a class="headerlink" href="#extended-analysis" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-mod docutils literal"><span class="pre">coal_analyse</span></code> module can be used for more extensive simulation analysis, such
as comparing simulated landscapes to real data and calculating goodness of fits.</p>
<p>The general procedure for using this module involves a few functions, all contained in the
<a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree" title="pycoalescence.coalescence_tree.CoalescenceTree"><code class="xref py py-class docutils literal"><span class="pre">CoalescenceTree</span> <span class="pre">class</span></code></a>.</p>
<ul class="simple">
<li><a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.set_database" title="pycoalescence.coalescence_tree.CoalescenceTree.set_database"><code class="xref py py-func docutils literal"><span class="pre">set_database()</span></code></a> generates the link to the SQL
database, which should be an output from a <strong>necsim</strong> simulation (run using the
<a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation" title="pycoalescence.simulation.Simulation"><code class="xref py py-class docutils literal"><span class="pre">Simulation</span> <span class="pre">class</span></code></a>).</li>
<li><code class="xref py py-func docutils literal"><span class="pre">import_comparison_data()</span></code> reads an SQL database which
contains real data to compare to the simulation output. The comparison data should contain the following tables:<ul>
<li>BIODIVERSITY_ METRICS, containing <em>only</em> &#8220;metric&#8221;, &#8220;fragment&#8221;, &#8220;value&#8221; and &#8220;number_of_individuals&#8221; columns.
The metric can be &#8220;fragment_richness&#8221; or any other metric created by your own functions which exists also in
the simulated data.</li>
<li>SPECIES_ABUNDANCES containing <em>at least</em> &#8220;SpeciesID&#8221;, &#8220;Abund&#8221;.</li>
</ul>
</li>
</ul>
<p>Additionally, one can provide the following if comparisons between fragments are required:</p>
<blockquote>
<div><ul class="simple">
<li>FRAGMENT_ABUNDANCES containing <em>at least</em> &#8220;Plot&#8221;, &#8220;Mnemonic&#8221; and &#8220;Abund&#8221;.</li>
<li>FRAGMENT_OCTAVES containing <em>at least</em> &#8220;fragment&#8221;, &#8220;octave&#8221;, &#8220;num_species&#8221;. This can also be calculated from
FRAGMENT_ABUNDANCES using <a class="reference internal" href="pycoalescence.html#pycoalescence.coalescence_tree.CoalescenceTree.calculate_comparison_octaves" title="pycoalescence.coalescence_tree.CoalescenceTree.calculate_comparison_octaves"><code class="xref py py-func docutils literal"><span class="pre">calculate_comparison_octaves()</span></code></a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="extended-features">
<h3><a class="toc-backref" href="#id6">Extended Features</a><a class="headerlink" href="#extended-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Read tif files and perform a number of operations taking into account georeferencing of the data.
Functionality is contained within the <a class="reference internal" href="pycoalescence.html#pycoalescence.map.Map" title="pycoalescence.map.Map"><code class="xref py py-class docutils literal"><span class="pre">Map</span> <span class="pre">class</span></code></a> (see <a class="reference internal" href="README_landscapes.html#map-reading"><span class="std std-ref">here</span></a>).</li>
<li>Generate fragmented landscapes (see <a class="reference internal" href="README_landscapes.html#generate-landscapes"><span class="std std-ref">here</span></a>). This may be useful for generating example
landscapes of a particular size with desired characteristics.</li>
<li>Simulate a dispersal kernel on a landscape to obtain characteristics of the effective dispersal kernel. Currently only
a single map is supported with &#8220;closed&#8221;, &#8220;infinite&#8221; or &#8220;tiled&#8221; landscape types (see <a class="reference internal" href="README_landscapes.html#simulate-landscapes"><span class="std std-ref">here</span></a>).</li>
<li>Simulations can be merged into a single output, with each simulation occupying a separate guild (see
<a class="reference internal" href="README_merger.html#merging-simulations"><span class="std std-ref">here</span></a>). Analyses can then be performed on the combined data.</li>
</ul>
</div>
<div class="section" id="testing-install">
<h3><a class="toc-backref" href="#id7">Testing install</a><a class="headerlink" href="#testing-install" title="Permalink to this headline">¶</a></h3>
<p>The system install can be tested by running <code class="xref py py-mod docutils literal"><span class="pre">test_install.py</span></code> from the command line
(<code class="docutils literal"><span class="pre">python</span> <span class="pre">test_install.py</span></code>) which requires that <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></code> has been successfully run previously.</p>
</div>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="essential">
<h3>Essential<a class="headerlink" href="#essential" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Python version 2 &gt;= 2.7.9 or 3 &gt;= 3.4.1</li>
<li>C++ compiler (such as GNU g++) with C++11 support.</li>
<li>The SQLite library available <a class="reference external" href="https://www.sqlite.org/download.html">here</a>. Require both <code class="docutils literal"><span class="pre">c++</span></code> and <code class="docutils literal"><span class="pre">python</span></code> installations.</li>
<li>The Boost library for C++ available <a class="reference external" href="http://www.boost.org">here</a>.</li>
<li>Numerical python (<code class="docutils literal"><span class="pre">numpy</span></code>) package.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Most packages, including their c++ libraries, can be installed using <cite>pip install package_name</cite> on most UNIX
systems.</p>
</div>
</div>
<div class="section" id="recommended">
<h3>Recommended<a class="headerlink" href="#recommended" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The gdal library for both python and C++ (<a class="reference external" href="http://www.gdal.org/">available here</a>). This is <strong>ESSENTIAL</strong> if you wish
to use .tif files for <a class="reference internal" href="necsim/necsim_library.html#introduction-necsim"><span class="std std-ref">necsim</span></a>.  It allows reading parameter information from .tif files
(using <a class="reference internal" href="pycoalescence.html#pycoalescence.simulation.Simulation.detect_map_dimensions" title="pycoalescence.simulation.Simulation.detect_map_dimensions"><code class="xref py py-func docutils literal"><span class="pre">detect_map_dimensions()</span></code></a>). Both the python
package and <code class="docutils literal"><span class="pre">c++</span></code> binaries are required; installation differs between systems, so view the gdal documentation for more
help installing gdal properly.</li>
<li>The fast-cpp-csv-parser by Ben Strasser, available
<a class="reference external" href="https://github.com/ben-strasser/fast-cpp-csv-parser">here</a>. This provides much faster csv read and write capabilities
and is probably essential for larger-scale simulations, but not necessary if your simulations are small. The folder
<em>fast-cpp-csv-parser/</em> should be in the same directory as your <strong>necsim</strong> C++ header files (the lib/necsim directory).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Running <code class="docutils literal"><span class="pre">configure</span></code> (or <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></code>) will detect system components, including <code class="docutils literal"><span class="pre">sqlite3</span></code>, <code class="docutils literal"><span class="pre">boost</span></code>,
<code class="docutils literal"><span class="pre">gdal</span></code> and <code class="docutils literal"><span class="pre">fast-cpp-csv-parser</span></code> and set the correct compilation flags.</p>
</div>
</div>
</div>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-grid">grid</dt>
<dd>Used to refer to the simulation area that is stored in memory as a matrix, for quick referencing. If no RAM
optimisations have been performed, this will be the same as the sample map. If also no sample map is used, this
will be the same as the fine map.</dd>
<dt id="term-sample-map">sample map</dt>
<dd>The map file containing the points to be sampled from. This is the most zoomed in level of the simulation, and
should encompass all starting locations of lineages.</dd>
<dt id="term-fine-map">fine map</dt>
<dd>The map file at a higher resolution (the same as the sample grid) which covers the area lineages are most likely
to move to, or where a higher spatial resolution is considered important.</dd>
<dt id="term-coarse-map">coarse map</dt>
<dd>The map file at a lower resolution (specified by the scale) which covers a larger area than the fine map. This is
to allow lineages to move far from their starting positions if required.</dd>
<dt id="term-pristine-map">pristine map</dt>
<dd>A historic map containing population densities at those times. Both fine and coarse pristine maps can be declared
and multiple sets of pristine maps can be declared at unique times.</dd>
</dl>
</div>
<div class="section" id="version">
<h2>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h2>
<p>Version 1.2.6</p>
</div>
<div class="section" id="contacts">
<h2>Contacts<a class="headerlink" href="#contacts" title="Permalink to this headline">¶</a></h2>
<p>Author: Samuel Thompson</p>
<p>Contact: <a class="reference external" href="mailto:samuelthompson14&#37;&#52;&#48;imperial&#46;ac&#46;uk">samuelthompson14<span>&#64;</span>imperial<span>&#46;</span>ac<span>&#46;</span>uk</a> - <a class="reference external" href="mailto:thompsonsed&#37;&#52;&#48;gmail&#46;com">thompsonsed<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
<p>Institution: Imperial College London and National University of
Singapore</p>
<p>This project is released under BSD-3 See file
<strong>LICENSE.txt</strong> or go to
<a class="reference external" href="https://opensource.org/licenses/BSD-3-Clause">here</a> for full license
details.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/PyCoal_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">pycoalescence</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#method">Method</a></li>
<li><a class="reference internal" href="#compilation-options">Compilation Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performing-simulations">Performing simulations</a><ul>
<li><a class="reference internal" href="#setting-up-simulations">Setting up simulations</a></li>
<li><a class="reference internal" href="#custom-configuration-files">Custom Configuration Files</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#dispersal-kernels">Dispersal Kernels</a></li>
<li><a class="reference internal" href="#differing-reproductive-rates">Differing reproductive rates</a></li>
<li><a class="reference internal" href="#limitations-of-simulation-variables">Limitations of simulation variables</a></li>
<li><a class="reference internal" href="#infinite-landscapes">Infinite Landscapes</a></li>
<li><a class="reference internal" href="#optimising-simulations">Optimising Simulations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-simulation-analysis">Post-simulation analysis</a></li>
<li><a class="reference internal" href="#extended-analysis">Extended analysis</a></li>
<li><a class="reference internal" href="#extended-features">Extended Features</a></li>
<li><a class="reference internal" href="#testing-install">Testing install</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#essential">Essential</a></li>
<li><a class="reference internal" href="#recommended">Recommended</a></li>
</ul>
</li>
<li><a class="reference internal" href="#glossary">Glossary</a></li>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#contacts">Contacts</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to pycoalescence</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="necsim/necsim_library.html"
                        title="next chapter">necim</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/README_pycoalescence.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="necsim/necsim_library.html" title="necim"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to pycoalescence"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pycoalescence 1.2.6 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Samuel Thompson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>