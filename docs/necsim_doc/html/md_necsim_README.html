<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>necsim: necsim</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="NECSim_logo_downscaled.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">necsim
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Neutral Ecology Coalescence Simulator - runs spatially explicit neutral models on a landscape.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_necsim_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">necsim </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Version: 1.0 This project is released under MIT licence See file <b>LICENSE.txt</b> or go to <a href="https://opensource.org/licenses/MIT">here</a> for full license details.</p>
<h2>CONTENTS</h2>
<ul>
<li><b>INTRODUCTION</b></li>
<li><b>INSTRUCTIONS</b></li>
<li><b>REQUIREMENTS</b></li>
<li><b>DEGUGGING</b></li>
<li><b>CLASS DESCRIPTIONS</b></li>
<li><b>KNOWN BUGS</b></li>
<li><b>FAQS</b></li>
<li><b>CONTACTS</b></li>
</ul>
<h2>INTRODUCTION</h2>
<p>necsim is a generic spatial coalescence simulator for neutral systems. It applies the model to map objects, which can change over time, for a specific set of supplied parameters, and outputs information for each individual to a SQL database.</p>
<p>necsim includes functionality for applying varying speciation rates after simulations are complete. This enables the main simulation to be run with the <em>minimum</em> speciation rate required and afterwards analysis can be completed using different speciation rates.</p>
<p>The recommended method of usage is through the pycoalescence package, using a python interface for installation, simulation setup and running. See <a href="http://pycoalescence.readthedocs.io/">here</a> for more details.</p>
<p>You are free to modify and distribute the code as per the license specified in <b>LICENCE.txt</b> to suit any additional neutral simulation requirements (or any other purpose).</p>
<h2>INSTRUCTIONS</h2>
<h3>Compiling the program</h3>
<p>See the Requirements section for a full list of the necessary prerequisites. Once these are installed, compiling the program should be relatively easy. NECSim requires a linker to the boost libraries, as well as the sqlite3 library. It is recommended to run with the maximum optimisation possible.</p>
<p>Additionally, if support is required for tif files (an alternative to importing csv files), the <a href="http://www.gdal.org/">gdal library</a> is required. See the online documentation for help compiling gdal for your operating system. When compiling using gdal, use the <code>-D with_gdal</code> compilation flag.</p>
<p>For compilation on High Performance Computing (HPC) systems, they will likely use intel compilers. The header files for the sqlite and boost packages may need to be copied in to the working directory to avoid problems with linking to libraries. Check the service providers' documentation for whether these libraries are already installed on the HPC. for the application of different speciation rates.</p>
<h3>Running simulations</h3>
<p>The routine relies on supplying command line arguments (see below) for all the major simulation variables. Alternatively, supplying a config .txt file and using the command line arguments <code>./necsim -c /path/to/config.txt</code> can be used for parsing command line arguments from the text file.</p>
<h4>Command Line Arguments</h4>
<p>The following command line arguments are required. This list can be accessed by running <code>“./necsim -h”</code> or <code>./necsim -help</code></p>
<p>The command line options to be specified are:</p>
<ol type="1">
<li>the seed for the simulation.</li>
<li>the simulation task (for file reference).</li>
<li>the map config file.</li>
<li>the output directory.</li>
<li>the minimum speciation rate.</li>
<li>the dispersal sigma value.</li>
<li>the dispersal tau value.</li>
<li>the deme size.</li>
<li>the deme sample size.</li>
<li>the maximum simulation time (in seconds).</li>
<li>the lambda value for moving through non-habitat.</li>
<li>the temporal sampling file containing tab-separated generation values for sampling points in time (null for only sampling the present)</li>
<li>the minimum number of species known to exist. (Currently has no effect).</li>
<li>(and onwards) speciation rates to apply after simulation.</li>
</ol>
<p>In this set up, the map config file contains a file on each line, with tab separation between the different variables. The "ref" flag contains the object type, followed by all other parameters. An example is given below.</p>
<p>ref=sample_grid path=/path/to/file x=100 y=200 mask=/path/to/mask ref=fine_map path=/path/to/file x=100 y=200 x_off=10 y_off=20 ref=historical_fine path=/path/to/file number=n rate=r time=g</p>
<p>Alternatively, by specifying the -f flag, (full mode) as the first argument, the program can read in extended command line arguments, which are as followed.</p>
<ol type="1">
<li>the task_iter used for setting the seed.</li>
<li>the sample grid x dimension</li>
<li>the sample grid y dimension</li>
<li>the fine map file relative path.</li>
<li>the fine map x dimension</li>
<li>the fine map y dimension</li>
<li>the fine map x offset</li>
<li>the fine map y offset</li>
<li>the coarse map file relative path.</li>
<li>the coarse map x dimension</li>
<li>the coarse map y dimension</li>
<li>the coarse map x offset</li>
<li>the coarse map y offset</li>
<li>the scale of the coarse map compared to the fine (10 means resolution of coarse map = 10 x resolution of fine map)</li>
<li>the output directory</li>
<li>the speciation rate.</li>
<li>the dispersal sigma value.</li>
<li>the deme size</li>
<li>the deme sample size (as a proportion of deme size)</li>
<li>the time to run the simulation (in seconds).</li>
<li>lambda - the relative cost of moving through non-forest</li>
<li>the_task - for referencing the specific task later on.</li>
<li>the minimum number of species the system is known to contain.</li>
<li>the historical fine map file to use</li>
<li>the historical coarse map file to use</li>
<li>the rate of forest change from historical</li>
<li>the time (in generations) since the historical forest was seen.</li>
<li>the dispersal tau value (the width of the kernel.</li>
<li>the sample mask, with binary 1:0 values for areas that we want to sample from. If this is not provided then this will default to mapping the whole area.</li>
<li>the link to the file containing every generation that the list should be expanded. This should be in the format of a list.</li>
<li>(and onwards) - speciation rates to apply after the simulation is complete.</li>
</ol>
<h4>Config Files</h4>
<p>The program also accepts a config file, specified by running <code>./necsim -c /path/to/config.txt</code>. The format of the config file is </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rand_seed = i</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;sample_x_dim = i</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;sample_y_dim = i</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;fine_source = /path/to/fine.csv</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;fine_x_dim = i</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;fine_y_dim = i</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;fine_x_offset = i</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;fine_y_offset = i</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;coarse_source = /path/to/coarse.csv</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;coarse_x_dim = i</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;coarse_y_dim = i</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;coarse_x_offset = i</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;coarse_y_offset = i</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;coarse_scale = i</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;output_dir = /path/to/outdir</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;spec_rate = d</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;zfat = f</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;deme_size = i</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;deme_sample = d</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;wall_time = i</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;lambda = 1</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;job_num = i</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;est_spec = i</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;historical_fine_source = /path/to/historical/fine.csv</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;historical_coarse_source = /path/to/historical/coarse.csv</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;forest_change = d</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;time_since = f</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;dispersal = f</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;sampledatamask = /path/to/sample/mask.csv</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;time_config_file = /path/to/time/file.txt</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;speciationrate1 = d</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;speciationrate2 = d</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;...</div></div><!-- fragment --><p> where <code>i</code> represents a positive integer, <code>d</code> is a decimal value between 0 and 1, and <code>f</code> is any positive number (float). Whilst this does help with readability of the code, the order of the arguments is essential at this stage (i.e. don't switch the order of the lines). Future versions may alter the system of reading such that the parameters are set according to their key. Any number of speciation rates (or 0) can be at the end of the file.</p>
<h4>Outputs</h4>
<p>Upon successful completion of a simulation, necsim will produce an SQLite database file in the output directory in an SQL_data folder. This database contains several tables, which can be accessed using a program like <a href="http://sqlitebrowser.org/">DB Browser for SQLite</a> or Microsoft Access. Alternatively, most programming languages have an SQLite interface (<a href="https://cran.r-project.org/web/packages/RSQLite/index.html">RSQlite</a>, <a href="https://docs.python.org/2/library/sqlite3.html">python sqlite3</a>)</p>
<ul>
<li>The main table within the database is the SPECIES_LIST table, which is the location and inheritence of every lineage recorded. Several other important data structures (such as whether it is a "tip" of the phylogenetic tree of not) which are used when re-constructing the species identity.</li>
<li>A secondary output from necims is a SIMULATION_PARAMETERS table for identifying the exact parameters with which the model is run.</li>
<li>SpeciationCounter also produces a SPECIES_ABUNDANCES table containing species abundances across the whole sample map, plus (optionally) a table of SPECIES_LOCATIONS (containing the x,y location of every individual) and FRAGMENT_ABUNDANCES (species abundances for each habitat fragment separately).</li>
</ul>
<h2>REQUIREMENTS</h2>
<ul>
<li>The SQLite library available <a href="https://www.sqlite.org/download.html">here</a>.</li>
<li>The Boost library available <a href="http://www.boost.org">here</a>.</li>
<li>The fast-cpp-csv-parser by Ben Strasser, available <a href="https://github.com/ben-strasser/fast-cpp-csv-parser">here</a>.</li>
<li>C++ compiler (such as GNU g++) with C++11 support.</li>
<li>Access to the relevant folders for Default simulations (see FAQS).</li>
</ul>
<h2>CLASS DESCRIPTIONS</h2>
<p>A brief description of the important classes is given below. Some classes also contain customised exceptions for better tracing of error handling.</p>
<ul>
<li>The <code><a class="el" href="class_tree.html">Tree</a></code> class.<ul>
<li>The most important class!</li>
<li>Contains the main setup, run and data output routines.</li>
<li>Setup imports the data files from csv (if necessary) and creates the in-memory objects for the storing of the coalescence tree and the spatial grid of active lineages. Setup time mostly depends on the size of the csv file being imported.</li>
<li>Run continually loops over sucessive coalesence, move or speciation events until all individuals have speciated or coalesced. This is where the majority of the simulation time will be, and is mostly dependent on the number of individuals, speciation rate and size of the spatial grid.</li>
<li>At the end of the simulation, the sqlCreate() routine will generate the in-memory SQLite database for storing the coalescent tree. It can run multiple times if multiple speciation rates are required. outputData() will then be called to create a small csv file containing important information, and output the SQLite database to file if required.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_tree_node.html" title="The TreeNode class that acts as a data storage object for the phylogenetic tree. ">TreeNode</a></code> class<ul>
<li>Contains a single record of a node on the phylogenetic tree, to be used in reassembling the tree structure at the end of the simulation.</li>
<li>Operations are mostly basic getters and setters, with functionality called from higher-level functions.</li>
<li>An array of treenodes makes up the <code>data</code> object in <code><a class="el" href="class_tree.html">Tree</a></code>.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_data_point.html" title="A data object used in coalescence simulations for calculating the output. Data from this object is ou...">DataPoint</a></code> class<ul>
<li>Contains a single record of the location of a lineage.</li>
<li>An array of datapoints makes up the <code>active</code> object in <code><a class="el" href="class_tree.html">Tree</a></code>.</li>
<li><code>endactive</code> refers to the number of lineages currently being simulated. After each coalescence or speciation event this will decrease.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_n_rrand.html" title="Contains the functions for random number generation. ">NRrand</a></code> class<ul>
<li>Contains the random number generator, as written by James Rosindell (<a href="#" onclick="location.href='mai'+'lto:'+'j.r'+'os'+'ind'+'el'+'l@i'+'mp'+'eri'+'al'+'.ac'+'.u'+'k'; return false;">j.ros<span style="display: none;">.nosp@m.</span>inde<span style="display: none;">.nosp@m.</span>ll@im<span style="display: none;">.nosp@m.</span>peri<span style="display: none;">.nosp@m.</span>al.ac<span style="display: none;">.nosp@m.</span>.uk</a>).</li>
</ul>
</li>
<li>The <code><a class="el" href="class_landscape.html" title="Contains all maps and provides the functions for accessing a grid cell in the correct temporal and sp...">Landscape</a></code> class<ul>
<li>Contains the routines for importing and calling values from the map objects.</li>
<li>The <code>getVal()</code> and <code>runDispersal()</code> functions can be modified to produce altered dispersal behaviour, or alterations to the structure of the map.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_matrix.html" title="A class containing the Matrix object, set up as an array of Row objects. Includes basic operations...">Matrix</a></code> and <code><a class="el" href="class_row.html" title="Contains a template Row class and basic operations. Uses an array to store the row. ">Row</a></code> classes<ul>
<li>Based on code written by James Rosindell (<a href="#" onclick="location.href='mai'+'lto:'+'j.r'+'os'+'ind'+'el'+'l@i'+'mp'+'eri'+'al'+'.ac'+'.u'+'k'; return false;">j.ros<span style="display: none;">.nosp@m.</span>inde<span style="display: none;">.nosp@m.</span>ll@im<span style="display: none;">.nosp@m.</span>peri<span style="display: none;">.nosp@m.</span>al.ac<span style="display: none;">.nosp@m.</span>.uk</a>).</li>
<li>Handles indexing of the 2D object plus importing values from a csv file.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_species_list.html" title="Contains a list of the species that exist at one location. The Row object, list, contains the active ...">SpeciesList</a></code> class<ul>
<li>Contains the list of individuals, for application in a matrix, to essentially create a 3D array.</li>
<li>Handles the positioning of individuals in space within a grid cell.</li>
</ul>
</li>
<li>The <code><a class="el" href="class_config_option.html" title="Config option class to store and import options from a file. ">ConfigOption</a></code> class<ul>
<li>Contains basic functions for importing command line arguments from a config file, providing an alternative way of setting up simulations.</li>
</ul>
</li>
<li>The <code>TreeList</code> class<ul>
<li>Provides the routines for applying different speciation rates to a phylogenetic tree, to be used either immediately after simulation within necsim, or at a later time using SpeciationCounter.cpp</li>
</ul>
</li>
</ul>
<h2>KNOWN BUGS</h2>
<ul>
<li>Simulations run until completion, rather than aiming for a desired number of species. This is an intentional change. Functions related to this functionality remain but are deprecated.</li>
<li>Only continuous rectangular fragments are properly calculated. Other shapes must be calculated by post-processing.</li>
<li>3 fragments instead of 2 will be calculated for certain adjacent rectangular patches.</li>
</ul>
<h2>FAQS (WIP)</h2>
<ul>
<li><b>How do I get started?</b><ul>
<li>It is recommended to use the <a href="http://pycoalescence.readthedocs.io/">pycoalescence</a> package which simplifies installation of necsim, setting up and running simulations. This provides a much easier way to get started with necsim.</li>
</ul>
</li>
<li><b>Why can’t I compile the program?</b><ul>
<li>This could be due to a number of reasons, most likely that you haven’t compiled with access to the lsqlite3 or boost packages. Installation and compilation differs across different systems; for most UNIX systems, compiling with the linker arguments -lsqlite3 -lboost_filesystem and -lboost_system will solve problems with the compiler not finding the sqlite or boost header file.</li>
<li>Another option could be the potential lack of access to the fast-cpp-csv-parser by Ben Strasser, available <a href="https://github.com/ben-strasser/fast-cpp-csv-parser">here</a>. If use_csv has been defined at the head of the file, try without use_csv or download the csv parser and locate the folder within your working directory at compilation.</li>
</ul>
</li>
<li><b>Every time the program runs I get error code XXX.</b><ul>
<li>Check the ERROR_REF.txt file for descriptions of the files. Try running in debug mode by compiling with <code>-DDEBUG</code> to gain more information on the problem. Check the log output in /logs. It is most likely a problem with the set up of the map data (error checking is not yet properly implemented here).</li>
</ul>
</li>
</ul>
<h2>CONTACTS</h2>
<p>Author: <b>Samuel Thompson</b></p>
<p>Contact: <a href="#" onclick="location.href='mai'+'lto:'+'sam'+'ue'+'lth'+'om'+'pso'+'n1'+'4@i'+'mp'+'eri'+'al'+'.ac'+'.u'+'k'; return false;">samue<span style="display: none;">.nosp@m.</span>ltho<span style="display: none;">.nosp@m.</span>mpson<span style="display: none;">.nosp@m.</span>14@i<span style="display: none;">.nosp@m.</span>mperi<span style="display: none;">.nosp@m.</span>al.a<span style="display: none;">.nosp@m.</span>c.uk</a> - <a href="#" onclick="location.href='mai'+'lto:'+'tho'+'mp'+'son'+'se'+'d@g'+'ma'+'il.'+'co'+'m'; return false;">thomp<span style="display: none;">.nosp@m.</span>sons<span style="display: none;">.nosp@m.</span>ed@gm<span style="display: none;">.nosp@m.</span>ail.<span style="display: none;">.nosp@m.</span>com</a></p>
<p>Institution: Imperial College London and National University of Singapore</p>
<p>Based heavily on code by <b>James Rosindell</b></p>
<p>Contact: <a href="#" onclick="location.href='mai'+'lto:'+'j.r'+'os'+'ind'+'el'+'l@i'+'mp'+'eri'+'al'+'.ac'+'.u'+'k'; return false;">j.ros<span style="display: none;">.nosp@m.</span>inde<span style="display: none;">.nosp@m.</span>ll@im<span style="display: none;">.nosp@m.</span>peri<span style="display: none;">.nosp@m.</span>al.ac<span style="display: none;">.nosp@m.</span>.uk</a></p>
<p>Institution: Imperial College London </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
